<?php
$title = "Ventas al público";
$this->headTitle($title);
date_default_timezone_set('America/Mexico_City');
?>

<h3><?php echo $this->escapeHtml($title); ?></h3>
<div>
<fieldset>
    <legend>Datos generales</legend>
    <div class="col s4">
        <div class="label-container">
            <label>Atendió:</label>
            <p><?php echo $_SESSION["empleado_session"]["empleado_info"]["empleado_nombre"].' '.$_SESSION["empleado_session"]["empleado_info"]["empleado_apellidopaterno"]?></p>
        </div>
    </div>
    <div class="col s4">
        <div class="label-container">
            <label>Fecha:</label>
            <p><?php echo date('Y-m-d')?></p>
        </div>
    </div>
    <div class="col s4">
        <div class="label-container">
            <label>Hora:</label>
            <p><?php echo date('H:i:s')?></p>
        </div>
    </div>
</fieldset>
<br>
<div class="row">
<fieldset>
<legend>Para uso exclusivo del hospital</legend>
<label>Selecciona una acción</label>
<div class="col s12">
    <div id="radioNuevaVenta" class="col s4">
        <p onclick="javascript:nuevaVenta();" >
            <input class="with-gap" name="grupo1" type="radio" id="test3"  />
            <label for="test3">Nueva venta</label>
        </p>
    </div>
</div>
<div id="venta" class="hiddendiv">
    <?php $ventaForm->prepare();?>
    <?php echo $this->form()->openTag($ventaForm); ?>
    <div class="col s4">
        <div class="input-field">
            <?php echo $this->formHidden($ventaForm->get('idpaciente')->setValue($pacienteEntity->getIdpaciente())); ?>
        </div>
    </div>
    <div class="col s6 offset-s2">
        <div class="input-field">
            <?php echo $this->formText($ventaForm->get('venta_fecha')); ?>
            <?php echo $this->formLabel($ventaForm->get('venta_fecha')); ?>
            <span class="red-text hidden" for="venta_fecha" id="fecha_error">Debe selecionar una fecha.</span><br><br>
            <?php $showError=$this->formElementErrors($ventaForm->get('venta_fecha'));
            if(!empty($showError)):
                ?>
                <div class="center-align col" style="color: #e57373">
                    <i class="mdi-content-report prefix"></i>
                </div>
                <div class="center-align col s11 offset-s1" style="color: #e57373">
                    <?php
                    echo $showError;
                    ?>
                </div>
            <?php  endif;?>
        </div>
    </div>
    <br>
    <div id="botonGuardarVenta" class="right col s4">
        <button id="guardarVenta" style="width: 100%; height: 45px; margin-top: 20px;" class="btn waves-effect waves-light" type="submit">Guardar Venta
            <i class="mdi-content-save left"></i>
        </button>
    </div>
    <?php echo $this->form()->closeTag(); ?>
</div>

<div class="row">
    <?php if($pacienteQuery):?>
        <div class="col s4">
            <a style="width: 100%; height: 45px; padding-top: 5px;" class="btn center-align" href="<?php echo $this->url('venta')?>asignar/<?php echo $pacienteQuery->getIdpaciente()?>"><i class="mdi-editor-insert-comment left"></i>Nueva consula/admisión</a>
        </div>
    <?php endif;?>
</div>
<div id="cargosVenta" class="hiddendiv">
<fieldset>
<legend>Cargos al paciente</legend>
<div id="totalSuperior" class="col s9">
    <!-- Aquí agregamos los elementos con javascript -->
</div>
<div class=" col s3 offset-s9">
    <a id="nuevoCargoVentaArticulo" class="tooltipped modal-trigger right" data-position="right" data-tooltip="AgregarCargoventa" href='#create-modal-cargoventa-articulo'><i class="mdi-content-add-circle-outline prefix"></i>Agregar producto a cuenta</a>
</div>
<div id="cargoventaArticuloResult" class="col s12">
    <table class="hoverable striped">
        <thead>
        <tr>
            <th>Cantidad</th>
            <th>Articulo</th>
            <th>Descripción</th>
            <th>Salida</th>
            <th>Fecha/hora</th>
            <th>Precio</th>
            <th>Subtotal</th>
            <th>Opciones</th>
        </tr>
        </thead>
        <tbody>
        <!-- Aquí agregamos los elementos con javascript -->
        </tbody>
    </table>
</div>
<!-- Create Modal Structure -->
<div id="create-modal-cargoventa-articulo" class="modal bottom-sheet" style="width: 100%; bottom: 15px;">
    <div class="modal-content">
        <h3>Agregar producto a cuenta</h3>
        <div class="row" id="table-header">
            <?php $cargoventaForm->prepare();?>
            <?php echo $this->form()->openTag($cargoventaForm); ?>
            <div class="input-field">
                <?php echo $this->formHidden($cargoventaForm->get('idventa')); ?>
            </div>
            <div id="modalCargoventaArticulo" class="row">
                <div id="busquedaCargoventaArticulo" class="col s5">
                    <div class="input-field col s4 left" id="search-container">
                        <i class="mdi-action-search prefix"></i>
                        <?php echo $this->formText($cargoventaForm->get('busquedaArticulo')); ?>
                        <?php echo $this->formLabel($cargoventaForm->get('busquedaArticulo')); ?>
                    </div>
                    <div class="col s4">
                        <div class="input-field">
                            <?php echo $this->formSelect($cargoventaForm->get('cargoventaarticulo_by')); ?>
                            <span class="red-text hidden" for="cargoventaarticulo_by" id="cargoventaarticulo_by_error">Debe selecionar un tipo de busqueda.</span><br><br>
                        </div>
                    </div>
                    <div class="right col s4">
                        <button id="buscarCargoventaArticulo" style="width: 100%; height: 45px; margin-top: 20px;" class="btn light-blue lighten-3 waves-effect waves-light">Buscar</button>
                    </div>
                    <div id="fieldsetCargoventaArticulo" class="col s12">
                        <fieldset>
                            <legend>Artículo</legend>
                            <div id="fieldsetCargoventaArticuloEntity" class="left col s8">
                                <!-- Aquí agregamos los elementos con javascript -->
                            </div>
                            <div id="botonGuardarCargoventaArticulo" class="right col s4" style="margin-top: 80px;">
                                <button id="guardarCargoventaArticulo" class="btn waves-effect waves-light" type="submit">Agregar</button>
                            </div>
                        </fieldset>
                        <br>
                        <br>
                    </div>
                    <div id="tablaCargoventaArticulo" class="col s12">
                        <table>
                            <thead>
                            <tr>
                                <th>Existencias</th>
                                <th>Articulo</th>
                                <th>Descripción</th>
                                <th>Precio</th>
                                <th>Salida</th>
                            </tr>
                            </thead>
                            <tbody>
                            <!-- Aquí agregamos los elementos con javascript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="tablaCargoventaArticuloAgregado" class="col s7">
                    <table>
                        <thead>
                        <tr>
                            <th>Cantidad</th>
                            <th>Articulo</th>
                            <th>Descripción</th>
                            <th>Salida</th>
                            <th>Fecha/hora</th>
                            <th>Precio</th>
                            <th>Subtotal</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Aquí agregamos los elementos con javascript -->
                        </tbody>
                    </table>
                </div>
            </div>
            <?php echo $this->form()->closeTag(); ?>
        </div>
    </div>
</div>
<br>
<br>
<div class=" col s3 offset-s9">
    <a id="nuevoCargoVentaServicio" class="tooltipped modal-trigger right" data-position="right" data-tooltip="AgregarCargoventa" href='#create-modal-cargoventa-servicio'><i class="mdi-content-add-circle-outline prefix"></i>Agregar servicio a cuenta</a>
</div>
<!-- Create Modal Structure -->
<div id="create-modal-cargoventa-servicio" class="modal bottom-sheet" style="width: 100%; bottom: 15px;">
    <div class="modal-content">
        <h3>Agregar servicio a cuenta</h3>
        <div class="row" id="table-header">
            <?php $cargoventaForm->prepare();?>
            <?php echo $this->form()->openTag($cargoventaForm); ?>
            <div class="input-field">
                <?php echo $this->formHidden($cargoventaForm->get('idventa')); ?>
            </div>
            <div id="modalCargoventaServicio" class="row">
                <div id="busquedaCargoventaServicio" class="col s6">
                    <div class="input-field col s4 left" id="search-container">
                        <i class="mdi-action-search prefix"></i>
                        <?php echo $this->formText($cargoventaForm->get('busquedaServicio')); ?>
                        <?php echo $this->formLabel($cargoventaForm->get('busquedaServicio')); ?>
                    </div>
                    <div class="col s4">
                        <div class="input-field">
                            <?php echo $this->formSelect($cargoventaForm->get('cargoventaservicio_by')); ?>
                            <span class="red-text hidden" for="cargoventaservicio_by" id="cargoventaservicio_by_error">Debe selecionar un tipo de busqueda.</span><br><br>
                        </div>
                    </div>
                    <div class="right col s4">
                        <button id="buscarCargoventaServicio" style="width: 100%; height: 45px; margin-top: 20px;" class="btn light-blue lighten-3 waves-effect waves-light">Buscar</button>
                    </div>
                    <div id="fieldsetCargoventaServicio" class="col s12">
                        <fieldset>
                            <legend>Servicio</legend>
                            <div id="fieldsetCargoventaServicioEntity" class="left col s8">
                                <!-- Aquí agregamos los elementos con javascript -->
                            </div>
                            <div id="botonGuardarCargoventaServicio" class="right col s4" style="margin-top: 50px;">
                                <button id="guardarCargoventaServicio" class="btn waves-effect waves-light" type="submit">Agregar</button>
                            </div>
                        </fieldset>
                        <br>
                        <br>
                    </div>
                    <div id="tablaCargoventaServicio" class="col s12">
                        <table>
                            <thead>
                            <tr>
                                <th>Servicio</th>
                                <th>Descripción</th>
                                <th>Precio</th>
                            </tr>
                            </thead>
                            <tbody>
                            <!-- Aquí agregamos los elementos con javascript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="tablaCargoventaServicioAgregado" class="col s6">
                    <table>
                        <thead>
                        <tr>
                            <th>Cantidad</th>
                            <th>Servicio</th>
                            <th>Fecha/hora</th>
                            <th>Precio</th>
                            <th>Subtotal</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Aquí agregamos los elementos con javascript -->
                        </tbody>
                    </table>
                    <!-- Aquí agregamos los elementos con javascript -->
                </div>
            </div>
            <?php echo $this->form()->closeTag(); ?>
        </div>
    </div>
</div>
<!-- End Create Modal Structure -->
<div id="cargoventaServicioResult" class="col s12">
    <table class="hoverable striped">
        <thead>
        <tr>
            <th>Cantidad</th>
            <th>Servicio</th>
            <th>Descripción</th>
            <th>Fecha/hora</th>
            <th>Precio</th>
            <th>Subtotal</th>
            <th>Opciones</th>
        </tr>
        </thead>
        <tbody>
        <!-- Aquí agregamos los elementos con javascript -->
        </tbody>
    </table>
</div>
<div class="col s12">
    <div id="botonPagarAnticipoVenta" class="col s3">
        <!-- Aquí agregamos los elementos con javascript -->
    </div>
    <!-- Create Modal Structure -->
    <div id="create-modal-pagar-venta" class="modal bottom-sheet">
        <div class="modal-content">
            <div class="row">
                <fieldset>
                    <legend>Registro de Pago</legend>
                    <div class="col s12">
                        <div id="radioPagoVenta" class="col s4">
                            <p onclick="javascript:pagoVenta();" >
                                <input class="with-gap" name="grupo2" type="radio" id="radio2"  />
                                <label for="radio2">Pago</label>
                            </p>
                        </div>
                    </div>
                    <div id="pagoVenta" class="hiddendiv">
                        <!-- Agregamos elementos con Javascript -->
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
    <br>
    <br>
    <?php /*
    <div id="botonGenerarFactura" class="col s3">
        <!-- Aquí agregamos los elementos con javascript -->
    </div>
     * 
     */?>
    <?php /*
    <div id="botonGenerarNota" class="col s3">
        <!-- Aquí agregamos los elementos con javascript -->
    </div>
     * 
     */?>
    <div id="totalInferior" class="col s9">
        <!-- Aquí agregamos los elementos con javascript -->
    </div>
</div>
<div class="col s12">
    <?php /*
    <div id="botonVerFactura" class="col s3 offset-s2">
        <!-- Aquí agregamos los elementos con javascript -->
    </div>
     * 
     */?>
    <div id="botonCancelar" class="col s3">
        <!-- Aquí agregamos los elementos con javascript -->
    </div>
</div>
</fieldset>
</div>
<script type="text/javascript">
$(document).ready(function() {
    $('select').material_select();
    $("#venta_fecha").datepicker();
    $('.modal-trigger').leanModal();
    // timepicki
    //$('#venta_hora').timepicki();
    // lolliclock
    $('#venta_hora').lolliclock({autoclose:true});

    //Cargoventa
    $("#tablaCargoventaArticulo").tablesorter({headers:{5:{sorter:false}}});
    $("#tablaCargoventaArticulo").filterTable({inputSelector: '#search-container input',minRows:2});

});
function nuevaVenta() {
    if ($('#venta').hasClass('hiddendiv')){
        $('#venta').removeClass('hiddendiv')
    }
}

// Validamos formulario Venta
$('.red-text').hide();
$("#guardarVenta").click(function() {
    // Al utilizar el reloj, se crea la clase lolliclock... eliminamos la clase lolliclock-clickable de nuestro body
    $('body').removeClass('lolliclock-clickable');


    //Obtenemos el valor del campo fecha
    var venta_fecha = $("input#venta_fecha").val();

    //Validamos el campo fecha, simplemente miramos que no esté vacío
    if (venta_fecha == "") {
        if ($('span#fecha_error').hasClass('hidden')){
            $('span#fecha_error').removeClass('hidden');
            $("span#fecha_error").show();
            $("span#venta_fecha").focus();
        }
        return false;
    }else{
        $("span#fecha_error").hide();
    }

    //Obtenemos el valor del campo idpaciente
    var idpaciente = $("input#idpaciente").val();

    //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
    var dataString = 'idpaciente=' + idpaciente + '&venta_fecha=' + venta_fecha;

    $.ajax({
        type: "POST",
        url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
        dataType : 'json',
        data: dataString,
        jsonpCallback: 'callback',
        success: function(data) {
            $("input#idventa").val(JSON.stringify(data.ventaArray.idventa));

            if ($('#cargosVenta').hasClass('hiddendiv')){
                $('#cargosVenta').removeClass('hiddendiv')
                $('#botonGuardarVenta').addClass('hiddendiv')
                $('#cargosVenta').removeClass('hiddendiv')
            }
        }
    });

    return false;
});

$("#buscarCargoventaArticulo").click(function() {

    //Obtenemos el valor del selector de lugarinventario
    var busquedaArticulo = $("input#busquedaArticulo").val();

    //Obtenemos el valor del selector de lugarinventario
    var cargoventaarticulo_by = $("select#cargoventaarticulo_by").val();
    //Validamos el campo idlugarinventario, simplemente miramos que no esté vacío
    if (cargoventaarticulo_by == "") {
        if ($('span#cargoventaarticulo_by_error').hasClass('hidden')){
            $('span#cargoventaarticulo_by_error').removeClass('hidden');
            $("span#cargoventaarticulo_by_error").show();
            $("span#cargoventaarticulo_by").focus();
        }
        return false;
    }else{
        $("span#cargoventaarticulo_by_error").hide();
    }

    //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
    var dataString = 'cargoventaarticulo_by=' + cargoventaarticulo_by + '&busquedaArticulo=' + busquedaArticulo ;

    $.ajax({
        type: "POST",
        url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
        dataType : 'json',
        data: dataString,
        jsonpCallback: 'callback',
        success: function(data) {
            ordencompradetalleArray = []
            var ordencompradetalleEntity = data.ordencompradetalleArray
            $.each( ordencompradetalleEntity, function( key, value ) {
                ordencompradetalleArray.push({
                    "idordencompradetalle" : value.idordencompradetalle,
                    "idlugarinventario" : value.idlugarinventario,
                    "cargoventa_tipo" : value.cargoventa_tipo,
                    "cargoventa_fecha" : value.cargoventa_fecha,
                    "caducidad" : value.ordencompradetalle_caducidad,
                    "existencia" : value.existencia,
                    "articulo" : value.articulo,
                    "descripcion" : value.descripcion,
                    "precio" : value.precio,
                    "salida" : value.salida
                });
            });

            // Creamos nuestra tabla de colecciones
            generaTablaBuscarVentaArticulo(ordencompradetalleArray);

            // Seleccionamos un item de nuestra tabla de colecciones y construimos la entidad para agregarla como cargoventa
            $.each(ordencompradetalleArray, function(keys, values){
                // Si dan clic a una entidad de la colección
                $("#entidadArticulo-"+values.idordencompradetalle).click(function(){
                    if ($('#fieldsetCargoventaArticulo').hasClass('hiddendiv')){
                        $('#fieldsetCargoventaArticulo').removeClass('hiddendiv')
                    }
                    var br   = document.createElement("br");
                    var br2   = document.createElement("br");
                    var br3   = document.createElement("br");
                    var br4   = document.createElement("br");
                    var br5   = document.createElement("br");
                    // Creamos el input de cantidad de tipo select
                    var divinputCantidad = document.createElement('div');
                    divinputCantidad.className = "input-field";
                    divinputCantidad.setAttribute ( 'id', 'divinputCantidad' );
                    var select = document.createElement('select');
                    select.style.display = "inline";
                    select.style.width = "auto";
                    select.style.height = "auto";
                    select.setAttribute ( 'id', 'cantidad' );
                    // agregamos los valores <option> a seleccionar
                    for($i=1; $i<=values.existencia; $i++){
                        var selectOption = new Option($i,$i);
                        select.appendChild(selectOption);
                    }
                    // agregamos las options en nuestro select
                    divinputCantidad.appendChild(select);

                    // Creamos la entidad textual lista para agregar al cargoventa
                    var div = document.getElementById("fieldsetCargoventaArticuloEntity");
                    div.innerHTML = div.dir;
                    var textoArticulo = document.createTextNode("Artículo: "+values.articulo);
                    var textoDescripcion = document.createTextNode("Descrpción: "+values.descripcion);
                    var textoCaducidad = document.createTextNode("Caducidad: "+values.caducidad);
                    var textoDisponibleEn = document.createTextNode("Disponible en: "+values.salida);
                    var textoExistencia = document.createTextNode("Existencias: "+values.existencia);
                    var textoCantidad = document.createTextNode("Cantidad: ");
                    div.appendChild(textoArticulo);
                    div.appendChild(br);
                    div.appendChild(textoDescripcion);
                    div.appendChild(br2);
                    div.appendChild(textoCaducidad);
                    div.appendChild(br3);
                    div.appendChild(textoDisponibleEn);
                    div.appendChild(br4);
                    div.appendChild(textoExistencia);
                    div.appendChild(br5);
                    div.appendChild(textoCantidad);
                    div.appendChild(select);

                    // Actializar existencias

                    // El input ordencompradetalle solamente lo necesitamos para actualizar nuestra entidad artículo antes de agregar el cargo.
                    // Si el formulario ya tiene el input de idordencompradetalle lo eliminamos
                    if(document.getElementById('divinputIdordencompradetalle')){
                        var divinputIdordencompradetalleDelete = document.getElementById("divinputIdordencompradetalle");
                        divinputIdordencompradetalleDelete.parentNode.removeChild(divinputIdordencompradetalleDelete);
                    }
                    // Actializar existencias

                    // Si el formulario ya tiene el input de idlugarinventario lo eliminamos
                    if(document.getElementById('divinputIdlugarinventario')){
                        var divinputIdlugarinventarioDelete = document.getElementById("divinputIdlugarinventario");
                        divinputIdlugarinventarioDelete.parentNode.removeChild(divinputIdlugarinventarioDelete);
                    }
                    // Si el formulario ya tiene el input de cargoventa_tipo lo eliminamos
                    if(document.getElementById('divinputCargoventaTipo')){
                        var divinputCargoventaTipoDelete = document.getElementById("divinputCargoventaTipo");
                        divinputCargoventaTipoDelete.parentNode.removeChild(divinputCargoventaTipoDelete);
                    }
                    // Si el formulario ya tiene el input de cargoventa_fecha lo eliminamos
                    if(document.getElementById('divinputCargoventaFecha')){
                        var divinputCargoventaFechaDelete = document.getElementById("divinputCargoventaFecha");
                        divinputCargoventaFechaDelete.parentNode.removeChild(divinputCargoventaFechaDelete);
                    }

                    // Creamos nuestro Formulario con los datos a insertar en Cargoventa
                    var form = document.getElementById('CargoventaForm');
                    // Actializar existencias
                    // Creamos el input de idlugarinventario y le seteamos el valor que le corresponde
                    var divinputIdordencompradetalle = document.createElement('div');
                    divinputIdordencompradetalle.className = "input-field";
                    divinputIdordencompradetalle.setAttribute ( 'id', 'divinputIdordencompradetalle' );
                    var inputIdordencompradetalle = document.createElement('input');
                    inputIdordencompradetalle.setAttribute ( 'id', 'idordencompradetalle' );
                    inputIdordencompradetalle.setAttribute ( 'type', 'hidden' );
                    inputIdordencompradetalle.setAttribute ( 'name', 'idordencompradetalle' );
                    inputIdordencompradetalle.setAttribute ( 'value', values.idordencompradetalle );
                    divinputIdordencompradetalle.appendChild(inputIdordencompradetalle)
                    // Actializar existencias

                    // Creamos el input de idlugarinventario y le seteamos el valor que le corresponde
                    var divinputIdlugarinventario = document.createElement('div');
                    divinputIdlugarinventario.className = "input-field";
                    divinputIdlugarinventario.setAttribute ( 'id', 'divinputIdlugarinventario' );
                    var inputIdlugarinventario = document.createElement('input');
                    inputIdlugarinventario.setAttribute ( 'id', 'idlugarinventario' );
                    inputIdlugarinventario.setAttribute ( 'type', 'hidden' );
                    inputIdlugarinventario.setAttribute ( 'name', 'idlugarinventario' );
                    inputIdlugarinventario.setAttribute ( 'value', values.idlugarinventario );
                    divinputIdlugarinventario.appendChild(inputIdlugarinventario)
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaTipo = document.createElement('div');
                    divinputCargoventaTipo.className = "input-field";
                    divinputCargoventaTipo.setAttribute ( 'id', 'divinputCargoventaTipo' );
                    var inputCargoventaTipo = document.createElement('input');
                    inputCargoventaTipo.setAttribute ( 'id', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'type', 'hidden' );
                    inputCargoventaTipo.setAttribute ( 'name', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'value', values.cargoventa_tipo );
                    divinputCargoventaTipo.appendChild(inputCargoventaTipo);
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaFecha = document.createElement('div');
                    divinputCargoventaFecha.className = "input-field";
                    divinputCargoventaFecha.setAttribute ( 'id', 'divinputCargoventaFecha' );
                    var inputCargoventaFecha = document.createElement('input');
                    inputCargoventaFecha.setAttribute ( 'id', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'type', 'hidden' );
                    inputCargoventaFecha.setAttribute ( 'name', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'value', values.cargoventa_fecha );
                    divinputCargoventaFecha.appendChild(inputCargoventaFecha);
                    form.appendChild(divinputCargoventaFecha);
                    form.appendChild(divinputCargoventaTipo);
                    form.appendChild(divinputIdlugarinventario);
                    form.appendChild(divinputIdordencompradetalle);
                });
            });
        },
        error: function(){
            $('#modalCargoventaArticulo').prepend('<div class="card-panel #00086E-text red accent-2 guardado-ajax">Error al intentar buscar</div>')
        }
    });

    return false;
});

$("#buscarCargoventaServicio").click(function() {

    //Obtenemos el valor del selector de lugarinventario
    var busquedaServicio = $("input#busquedaServicio").val();

    //Obtenemos el valor del selector de lugarinventario
    var cargoventaservicio_by = $("select#cargoventaservicio_by").val();
    //Validamos el campo idlugarinventario, simplemente miramos que no esté vacío
    if (cargoventaservicio_by == "") {
        if ($('span#cargoventaservicio_by_error').hasClass('hidden')){
            $('span#cargoventaservicio_by_error').removeClass('hidden');
            $("span#cargoventaservicio_by_error").show();
            $("span#cargoventaservicio_by").focus();
        }
        return false;
    }else{
        $("span#cargoventaservicio_by_error").hide();
    }

    //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
    var dataString = 'cargoventaservicio_by=' + cargoventaservicio_by + '&busquedaServicio=' + busquedaServicio ;

    $.ajax({
        type: "POST",
        url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
        dataType : 'json',
        data: dataString,
        jsonpCallback: 'callback',
        success: function(data) {
            servicioArray = []
            var servicioEntity = data.servicioArray
            $.each( servicioEntity, function( key, value ) {
                servicioArray.push({
                    "idservicio" : value.idservicio,
                    "cargoventa_tipo" : value.cargoventa_tipo,
                    "cargoventa_fecha" : value.cargoventa_fecha,
                    "servicio_nombre" : value.servicio_nombre,
                    "servicio_descripcion" : value.servicio_descripcion,
                    "servicio_precio" : value.servicio_precio
                });
            });

            // Creamos nuestra tabla de colecciones
            generaTablaBuscarVentaServicio(servicioArray);

            // Seleccionamos un item de nuestra tabla de colecciones y construimos la entidad para agregarla como cargoventa
            $.each(servicioArray, function(keys, values){
                // Si dan clic a una entidad de la colección
                $("#entidadServicio-"+values.idservicio).click(function(){
                    if ($('#fieldsetCargoventaServicio').hasClass('hiddendiv')){
                        $('#fieldsetCargoventaServicio').removeClass('hiddendiv')
                    }
                    var br   = document.createElement("br");
                    var br2   = document.createElement("br");
                    var br3   = document.createElement("br");
                    var br4   = document.createElement("br");
                    // Creamos el input de cantidad de tipo input
                    var divinputCantidad = document.createElement('div');
                    divinputCantidad.className = "input-field";
                    divinputCantidad.setAttribute ( 'id', 'divinputCantidad' );
                    var inputCantidad = document.createElement('input');
                    inputCantidad.setAttribute ( 'id', 'cantidad' );
                    inputCantidad.style.width = "20%";
                    inputCantidad.type = "number";
                    inputCantidad.min ="1";
                    inputCantidad.max = "999999999";

                    // agregamos las options en nuestro input
                    divinputCantidad.appendChild(inputCantidad);

                    // Creamos la entidad textual lista para agregar al cargoventa
                    var div = document.getElementById("fieldsetCargoventaServicioEntity");
                    div.innerHTML = div.dir;
                    var textoServicioNombre = document.createTextNode("Servicio: "+values.servicio_nombre);
                    var textoServicioDescripcion = document.createTextNode("Descrpción: "+values.servicio_descripcion);
                    var textoServicioPrecio = document.createTextNode("Precio: "+values.servicio_precio);
                    var textoCargoventaFecha = document.createTextNode("Fecha: "+values.cargoventa_fecha);
                    var textoCantidad = document.createTextNode("Cantidad: ");
                    div.appendChild(textoServicioNombre);
                    div.appendChild(br);
                    div.appendChild(textoServicioDescripcion);
                    div.appendChild(br2);
                    div.appendChild(textoServicioPrecio);
                    div.appendChild(br3);
                    div.appendChild(textoCargoventaFecha);
                    div.appendChild(br4);
                    div.appendChild(textoCantidad);
                    div.appendChild(inputCantidad);

                    // El input idservicio solamente lo necesitamos para actualizar nuestra entidad servicio antes de agregar el cargo.
                    // Si el formulario ya tiene el input de idservicio lo eliminamos
                    if(document.getElementById('divinputIdservicio')){
                        var divinputIdservicioDelete = document.getElementById("divinputIdservicio");
                        divinputIdservicioDelete.parentNode.removeChild(divinputIdservicioDelete);
                    }

                    // Si el formulario ya tiene el input de servicio_nombre lo eliminamos
                    if(document.getElementById('divinputCargoventaTipo')){
                        var divinputCargoventaTipoDelete = document.getElementById("divinputCargoventaTipo");
                        divinputCargoventaTipoDelete.parentNode.removeChild(divinputCargoventaTipoDelete);
                    }
                    // Si el formulario ya tiene el input de servicio_descripcion lo eliminamos
                    if(document.getElementById('divinputCargoventaFecha')){
                        var divinputCargoventaFechaDelete = document.getElementById("divinputCargoventaFecha");
                        divinputCargoventaFechaDelete.parentNode.removeChild(divinputCargoventaFechaDelete);
                    }

                    // Creamos nuestro Formulario con los datos a insertar en Cargoventa
                    var form = document.getElementById('CargoventaForm');
                    // Creamos el input de idlugarinventario y le seteamos el valor que le corresponde
                    var divinputIdservicio = document.createElement('div');
                    divinputIdservicio.className = "input-field";
                    divinputIdservicio.setAttribute ( 'id', 'divinputIdservicio' );
                    var inputIdservicio = document.createElement('input');
                    inputIdservicio.setAttribute ( 'id', 'idservicio' );
                    inputIdservicio.setAttribute ( 'type', 'hidden' );
                    inputIdservicio.setAttribute ( 'name', 'idservicio' );
                    inputIdservicio.setAttribute ( 'value', values.idservicio );
                    divinputIdservicio.appendChild(inputIdservicio)
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaTipo = document.createElement('div');
                    divinputCargoventaTipo.className = "input-field";
                    divinputCargoventaTipo.setAttribute ( 'id', 'divinputCargoventaTipo' );
                    var inputCargoventaTipo = document.createElement('input');
                    inputCargoventaTipo.setAttribute ( 'id', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'type', 'hidden' );
                    inputCargoventaTipo.setAttribute ( 'name', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'value', values.cargoventa_tipo );
                    divinputCargoventaTipo.appendChild(inputCargoventaTipo);
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaFecha = document.createElement('div');
                    divinputCargoventaFecha.className = "input-field";
                    divinputCargoventaFecha.setAttribute ( 'id', 'divinputCargoventaFecha' );
                    var inputCargoventaFecha = document.createElement('input');
                    inputCargoventaFecha.setAttribute ( 'id', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'type', 'hidden' );
                    inputCargoventaFecha.setAttribute ( 'name', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'value', values.cargoventa_fecha );
                    divinputCargoventaFecha.appendChild(inputCargoventaFecha);
                    form.appendChild(divinputCargoventaFecha);
                    form.appendChild(divinputCargoventaTipo);
                    form.appendChild(divinputIdservicio);
                });
            });
        },
        error: function(){
            $('#modalCargoventaArticulo').prepend('<div class="card-panel #00086E-text red accent-2 guardado-ajax">Error al intentar buscar</div>')
        }
    });

    return false;
});

function generaTablaBuscarVentaArticulo(ordencompradetalleArray) {

    // Obtener la referencia del elemento div con id = tablaCargoventaArticulo
    var div = document.getElementById("tablaCargoventaArticulo");
    div.innerHTML = div.dir;
    // Crea un elemento <table> y un elemento <thead> y <tbody>
    var tabla   = document.createElement("table");
    tabla.className = "hoverable striped";
    var tblHead = document.createElement("thead");
    var tblBody = document.createElement("tbody");
    var thArray = ['Existencias', 'Articulo', 'Descripción', 'Precio', 'Salida']

    // Crea las celdas
    for (var i = 0; i < 1; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <th> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <th>, ubica el elemento <th> al final
            // de la hilera de la tabla
            var celda = document.createElement("th");
            var textoCelda = document.createTextNode(thArray[j]);
            celda.appendChild(textoCelda);
            hilera.appendChild(celda);
        }

        // agrega la hilera al final de la tabla (al final del elemento tblHead)
        tblHead.appendChild(hilera);
    }

    // posiciona el <thead> debajo del elemento <table>
    tabla.appendChild(tblHead);

    // Crea las celdas
    for (var i = 0; i < ordencompradetalleArray.length; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");
        hilera.className = "pointer";
        // Le agregamos un id a la entidad <th>
        hilera.setAttribute('id', 'entidadArticulo-' + ordencompradetalleArray[i]["idordencompradetalle"])

        for (var j = 0; j < thArray.length; j++) {

            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("td");

            if(j == 0){
                var textoCelda = document.createTextNode(ordencompradetalleArray[i]["existencia"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 1){
                var textoCelda = document.createTextNode(ordencompradetalleArray[i]["articulo"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 2){
                var textoCelda = document.createTextNode(ordencompradetalleArray[i]["descripcion"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 3){
                var textoCelda = document.createTextNode("$"+ordencompradetalleArray[i]["precio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 4){
                var textoCelda = document.createTextNode(ordencompradetalleArray[i]["salida"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
        }

        // agrega la hilera al final de la tabla (al final del elemento tblbody)
        tblBody.appendChild(hilera);
    }

    // posiciona el <tbody> debajo del elemento <table>
    tabla.appendChild(tblBody);

    // appends <table> into <div>
    div.appendChild(tabla);
}

function generaTablaBuscarVentaServicio(servicioArray) {

    // Obtener la referencia del elemento div con id = tablaCargoventaArticulo
    var div = document.getElementById("tablaCargoventaServicio");
    div.innerHTML = div.dir;
    // Crea un elemento <table> y un elemento <thead> y <tbody>
    var tabla   = document.createElement("table");
    tabla.className = "hoverable striped";
    var tblHead = document.createElement("thead");
    var tblBody = document.createElement("tbody");
    var thArray = ['Servicio', 'Descripción', 'Precio']

    // Crea las celdas
    for (var i = 0; i < 1; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <th> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <th>, ubica el elemento <th> al final
            // de la hilera de la tabla
            var celda = document.createElement("th");
            var textoCelda = document.createTextNode(thArray[j]);
            celda.appendChild(textoCelda);
            hilera.appendChild(celda);
        }

        // agrega la hilera al final de la tabla (al final del elemento tblHead)
        tblHead.appendChild(hilera);
    }

    // posiciona el <thead> debajo del elemento <table>
    tabla.appendChild(tblHead);

    // Crea las celdas
    for (var i = 0; i < servicioArray.length; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");
        hilera.className = "pointer";
        // Le agregamos un id a la entidad <th>
        hilera.setAttribute('id', 'entidadServicio-' + servicioArray[i]["idservicio"])

        for (var j = 0; j < thArray.length; j++) {

            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("td");

            if(j == 0){
                var textoCelda = document.createTextNode(servicioArray[i]["servicio_nombre"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 1){
                var textoCelda = document.createTextNode(servicioArray[i]["servicio_descripcion"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 2){
                var textoCelda = document.createTextNode(servicioArray[i]["servicio_precio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
        }

        // agrega la hilera al final de la tabla (al final del elemento tblbody)
        tblBody.appendChild(hilera);
    }

    // posiciona el <tbody> debajo del elemento <table>
    tabla.appendChild(tblBody);

    // appends <table> into <div>
    div.appendChild(tabla);
}

$("#guardarCargoventaArticulo").click(function() {

    // Actializar existencias
    //Obtenemos el valor del selector de venta
    var idordencompradetalle = $("input#idordencompradetalle").val();
    // Actializar existencias

    //Obtenemos el valor del selector de venta
    var idventa = $("input#idventa").val();
    //Obtenemos el valor del selector de lugarinventario
    var idlugarinventario = $("input#idlugarinventario").val();
    //Obtenemos el valor del campo cargoventa_tipo
    var cargoventa_tipo = $("input#cargoventa_tipo").val();
    //Obtenemos el valor del campo cargoventa_fecha
    var cargoventa_fecha = $("input#cargoventa_fecha").val();
    //Obtenemos el valor del campo cantidad
    var cantidad = $("select#cantidad").val();

    if(cantidad == null){
        //$('#modalCargoventaArticulo').prepend('<div class="card-panel #00086E-text red accent-2 error-modal-ajax">Error al intentar agregar. Ya no hay artículos en existencia.</div>')
        alert("Error al intentar agregar. No hay artículos en existencia");
        return false;
    }

    //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
    var dataString = 'idventa=' + idventa + '&idlugarinventario=' + idlugarinventario + '&cargoventa_tipo=' + cargoventa_tipo + '&cargoventa_fecha=' + cargoventa_fecha + '&cantidad=' + cantidad;

    $.ajax({
        type: "POST",
        url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
        dataType : 'json',
        data: dataString,
        jsonpCallback: 'callback',
        success: function(data) {
            //$('#cargosVenta').prepend('<div class="card-panel #00086E-text green accent-2 guardado-ajax"">Cargo guardada exitosamente</div>')
            //$('#modalCargoventaArticulo').prepend('<div class="card-panel #00086E-text green accent-2 guardado-modal-ajax"">Cargo agregado exitosamente</div>')
            alert("Cargo agregado exitosamente");

            //console.log(data.cargoventaArray);
            cargoventaArray = []
            var cargoventaEntity = data.cargoventaArray
            $.each( cargoventaEntity, function( key, value ) {
                cargoventaArray.push({
                    "idcargoventa" : value.idcargoventa,
                    "idventa" : value.idventa,
                    "status" : value.status,
                    "cantidad" : value.cantidad,
                    "articulo" : value.articulo,
                    "descripcion" : value.descripcion,
                    "salida" : value.salida,
                    "fechahora" : value.fechahora,
                    "precio" : value.precio,
                    "subtotal" : value.subtotal
                });
            });

            if ($('#cargoventaArticuloResult').hasClass('hiddendiv')){
                $('#cargoventaArticuloResult').removeClass('hiddendiv')
            }

            tablaCargoventaArticuloAgregadoModal(cargoventaArray);
            tablaCargoventaArticuloAgregado(cargoventaArray);
            // Refrescamos
            buscarCargoventaArticulo(idordencompradetalle);

        },
        error: function(){
            //$('#cargosVenta').prepend('<div class="card-panel #00086E-text red accent-2 guardado-ajax">Error al intentar guardar</div>')
            //$('#modalCargoventaArticulo').prepend('<div class="card-panel #00086E-text red accent-2 error-modal-ajax">Error al intentar agregar</div>')
            alert("Error al intentar agregar");
        }
    });

    return false;
});

$("#guardarCargoventaServicio").click(function() {

    //Obtenemos el valor del selector de venta
    var idventa = $("input#idventa").val();
    //Obtenemos el valor del selector de lugarinventario
    var idservicio = $("input#idservicio").val();
    //Obtenemos el valor del campo cargoventa_tipo
    var cargoventa_tipo = $("input#cargoventa_tipo").val();
    //Obtenemos el valor del campo cargoventa_fecha
    var cargoventa_fecha = $("input#cargoventa_fecha").val();
    //Obtenemos el valor del campo cantidad
    var cantidad = $("input#cantidad").val();

    //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
    var dataString = 'idventa=' + idventa + '&idservicio=' + idservicio + '&cargoventa_tipo=' + cargoventa_tipo + '&cargoventa_fecha=' + cargoventa_fecha + '&cantidad=' + cantidad;

    $.ajax({
        type: "POST",
        url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
        dataType : 'json',
        data: dataString,
        jsonpCallback: 'callback',
        success: function(data) {
            //$('#cargosVenta').prepend('<div class="card-panel #00086E-text green accent-2 guardado-ajax"">Cargo guardada exitosamente</div>')
            //$('#modalCargoventaArticulo').prepend('<div class="card-panel #00086E-text green accent-2 guardado-modal-ajax"">Cargo agregado exitosamente</div>')
            alert("Cargo agregado exitosamente");

            //console.log(data.cargoventaArray);
            cargoventaArray = []
            var cargoventaEntity = data.cargoventaArray
            $.each( cargoventaEntity, function( key, value ) {
                cargoventaArray.push({
                    "idcargoventa" : value.idcargoventa,
                    "idventa" : value.idventa,
                    "status" : value.status,
                    "cantidad" : value.cantidad,
                    "servicio" : value.servicio,
                    "descripcion" : value.descripcion,
                    "precio" : value.precio,
                    "subtotal" : value.subtotal,
                    "fechahora" : value.fechahora
                });
            });

            if ($('#cargoventaServicioResult').hasClass('hiddendiv')){
                $('#cargoventaServicioResult').removeClass('hiddendiv')
            }

            tablaCargoventaServicioAgregadoModal(cargoventaArray);
            tablaCargoventaServicioAgregado(cargoventaArray);
            // Refrescamos
            buscarCargoventaServicio(idservicio);

        },
        error: function(){
            //$('#cargosVenta').prepend('<div class="card-panel #00086E-text red accent-2 guardado-ajax">Error al intentar guardar</div>')
            //$('#modalCargoventaArticulo').prepend('<div class="card-panel #00086E-text red accent-2 error-modal-ajax">Error al intentar agregar</div>')
            alert("Error al intentar agregar");
        }
    });

    return false;
});

function tablaCargoventaArticuloAgregadoModal(cargoventaArray) {

    // Obtener la referencia del elemento div con id = tablaCargoventaArticuloAgregado
    var div = document.getElementById("tablaCargoventaArticuloAgregado");
    div.innerHTML = div.dir;
    // Creamos el elemento <table>
    var tabla   = document.createElement("table");
    // Agregamos clases el elemento <table>
    tabla.className = "hoverable striped";
    // Creamos el elemento <thead>
    var tblHead = document.createElement("thead");
    // Creamos el elemento <tbody>
    var tblBody = document.createElement("tbody");

    // Creamos un array con las columnas de nuestra tabla
    var thArray = ['Cantidad', 'Articulo', 'Descripción', 'Salida', 'Fecha/hora', 'Precio', 'Subtotal']

    // Crea las celdas
    for (var i = 0; i < 1; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("th");
            var textoCelda = document.createTextNode(thArray[j]);
            celda.appendChild(textoCelda);
            hilera.appendChild(celda);
        }

        // agrega la hilera al final de la tabla (al final del elemento tblHead)
        tblHead.appendChild(hilera);
    }

    // posiciona el <thead> debajo del elemento <tbody>
    tabla.appendChild(tblHead);

    // Crea las celdas
    for (var i = 0; i < cargoventaArray.length; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("td");

            if(j == 0){
                var textoCelda = document.createTextNode(cargoventaArray[i]["cantidad"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 1){
                var textoCelda = document.createTextNode(cargoventaArray[i]["articulo"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 2){
                var textoCelda = document.createTextNode(cargoventaArray[i]["descripcion"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 3){
                var textoCelda = document.createTextNode(cargoventaArray[i]["salida"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 4){
                var textoCelda = document.createTextNode(cargoventaArray[i]["fechahora"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 5){
                var textoCelda = document.createTextNode(cargoventaArray[i]["precio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 6){
                var textoCelda = document.createTextNode(cargoventaArray[i]["subtotal"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
        }

        // agrega la hilera al final de la tabla (al final del elemento tblbody)
        tblBody.appendChild(hilera);
    }

    // posiciona el <tbody> debajo del elemento <table>
    tabla.appendChild(tblBody);

    // appends <table> into <body>
    div.appendChild(tabla);

}
function tablaCargoventaServicioAgregadoModal(cargoventaArray) {

    // Obtener la referencia del elemento div con id = tablaCargoventaServicioAgregado
    var div = document.getElementById("tablaCargoventaServicioAgregado");
    div.innerHTML = div.dir;
    // Creamos el elemento <table>
    var tabla   = document.createElement("table");
    // Agregamos clases el elemento <table>
    tabla.className = "hoverable striped";
    // Creamos el elemento <thead>
    var tblHead = document.createElement("thead");
    // Creamos el elemento <tbody>
    var tblBody = document.createElement("tbody");

    // Creamos un array con las columnas de nuestra tabla
    var thArray = ['Cantidad', 'Servicio', /*'Descripción',*/ 'Fecha/hora', 'Precio', 'Subtotal']

    // Crea las celdas
    for (var i = 0; i < 1; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("th");
            var textoCelda = document.createTextNode(thArray[j]);
            celda.appendChild(textoCelda);
            hilera.appendChild(celda);
        }

        // agrega la hilera al final de la tabla (al final del elemento tblHead)
        tblHead.appendChild(hilera);
    }

    // posiciona el <thead> debajo del elemento <tbody>
    tabla.appendChild(tblHead);

    // Crea las celdas
    for (var i = 0; i < cargoventaArray.length; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("td");

            if(j == 0){
                var textoCelda = document.createTextNode(cargoventaArray[i]["cantidad"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 1){
                var textoCelda = document.createTextNode(cargoventaArray[i]["servicio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            /*
             if(j == 2){
             var textoCelda = document.createTextNode(cargoventaArray[i]["descripcion"]);
             celda.appendChild(textoCelda);
             hilera.appendChild(celda);
             }
             */
            if(j == 2){
                var textoCelda = document.createTextNode(cargoventaArray[i]["fechahora"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 3){
                var textoCelda = document.createTextNode(cargoventaArray[i]["precio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 4){
                var textoCelda = document.createTextNode(cargoventaArray[i]["subtotal"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
        }

        // agrega la hilera al final de la tabla (al final del elemento tblbody)
        tblBody.appendChild(hilera);
    }

    // posiciona el <tbody> debajo del elemento <table>
    tabla.appendChild(tblBody);

    // appends <table> into <body>
    div.appendChild(tabla);

}
function buscarCargoventaArticulo(idordencompradetalle){

    //Obtenemos el valor del selector de lugarinventario
    var busquedaArticulo = $("input#busquedaArticulo").val();

    //Obtenemos el valor del selector de lugarinventario
    var cargoventaarticulo_by = $("select#cargoventaarticulo_by").val();
    //Validamos el campo cargoventaarticulo_by, simplemente miramos que no esté vacío
    if (cargoventaarticulo_by == "") {
        if ($('span#cargoventaarticulo_by_error').hasClass('hidden')){
            $('span#cargoventaarticulo_by_error').removeClass('hidden');
            $("span#cargoventaarticulo_by_error").show();
            $("span#cargoventaarticulo_by").focus();
        }
        return false;
    }else{
        $("span#cargoventaarticulo_by_error").hide();
    }

    //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
    var dataString = 'cargoventaarticulo_by=' + cargoventaarticulo_by + '&busquedaArticulo=' + busquedaArticulo ;

    $.ajax({
        type: "POST",
        url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
        dataType : 'json',
        data: dataString,
        jsonpCallback: 'callback',
        success: function(data) {
            ordencompradetalleArray = []
            var ordencompradetalleEntity = data.ordencompradetalleArray;
            $.each( ordencompradetalleEntity, function( key, value ) {
                ordencompradetalleArray.push({
                    "idordencompradetalle" : value.idordencompradetalle,
                    "idlugarinventario" : value.idlugarinventario,
                    "cargoventa_tipo" : value.cargoventa_tipo,
                    "cargoventa_fecha" : value.cargoventa_fecha,
                    "caducidad" : value.ordencompradetalle_caducidad,
                    "existencia" : value.existencia,
                    "articulo" : value.articulo,
                    "descripcion" : value.descripcion,
                    "precio" : value.precio,
                    "salida" : value.salida
                });
            });

            // Creamos nuestra tabla de colecciones
            generaTablaBuscarVentaArticulo(ordencompradetalleArray);

            // Seleccionamos un item de nuestra tabla de colecciones y construimos la entidad para agregarla como cargoventa
            $.each(ordencompradetalleArray, function(keys, values){

                // Mantenemos el foco en el artículo que se esta agregando
                if(idordencompradetalle == values.idordencompradetalle){
                    if ($('#fieldsetCargoventaArticulo').hasClass('hiddendiv')){
                        $('#fieldsetCargoventaArticulo').removeClass('hiddendiv')
                    }
                    var br   = document.createElement("br");
                    var br2   = document.createElement("br");
                    var br3   = document.createElement("br");
                    var br4   = document.createElement("br");
                    var br5   = document.createElement("br");
                    // Creamos el input de cantidad de tipo select
                    var divinputCantidad = document.createElement('div');
                    divinputCantidad.className = "input-field";
                    divinputCantidad.setAttribute ( 'id', 'divinputCantidad' );
                    var select = document.createElement('select');
                    select.style.display = "inline";
                    select.style.width = "auto";
                    select.style.height = "auto";
                    select.setAttribute ( 'id', 'cantidad' );
                    // agregamos los valores <option> a seleccionar
                    for($i=1; $i<=values.existencia; $i++){
                        var selectOption = new Option($i,$i);
                        select.appendChild(selectOption);
                    }
                    // agregamos las options en nuestro select
                    divinputCantidad.appendChild(select);

                    // Creamos la entidad textual lista para agregar al cargoventa
                    var div = document.getElementById("fieldsetCargoventaArticuloEntity");
                    div.innerHTML = div.dir;
                    var textoArticulo = document.createTextNode("Artículo: "+values.articulo);
                    var textoDescripcion = document.createTextNode("Descrpción: "+values.descripcion);
                    var textoCaducidad = document.createTextNode("Caducidad: "+values.caducidad);
                    var textoDisponibleEn = document.createTextNode("Disponible en: "+values.salida);
                    var textoExistencia = document.createTextNode("Existencias: "+values.existencia);
                    var textoCantidad = document.createTextNode("Cantidad: ");
                    div.appendChild(textoArticulo);
                    div.appendChild(br);
                    div.appendChild(textoDescripcion);
                    div.appendChild(br2);
                    div.appendChild(textoCaducidad);
                    div.appendChild(br3);
                    div.appendChild(textoDisponibleEn);
                    div.appendChild(br4);
                    div.appendChild(textoExistencia);
                    div.appendChild(br5);
                    div.appendChild(textoCantidad);
                    div.appendChild(select);

                    // Actializar existencias

                    // El input ordencompradetalle solamente lo necesitamos para actualizar nuestra entidad artículo antes de agregar el cargo.
                    // Si el formulario ya tiene el input de idordencompradetalle lo eliminamos
                    if(document.getElementById('divinputIdordencompradetalle')){
                        var divinputIdordencompradetalleDelete = document.getElementById("divinputIdordencompradetalle");
                        divinputIdordencompradetalleDelete.parentNode.removeChild(divinputIdordencompradetalleDelete);
                    }
                    // Actializar existencias

                    // Si el formulario ya tiene el input de idlugarinventario lo eliminamos
                    if(document.getElementById('divinputIdlugarinventario')){
                        var divinputIdlugarinventarioDelete = document.getElementById("divinputIdlugarinventario");
                        divinputIdlugarinventarioDelete.parentNode.removeChild(divinputIdlugarinventarioDelete);
                    }
                    // Si el formulario ya tiene el input de idlugarinventario lo eliminamos
                    if(document.getElementById('divinputCargoventaTipo')){
                        var divinputCargoventaTipoDelete = document.getElementById("divinputCargoventaTipo");
                        divinputCargoventaTipoDelete.parentNode.removeChild(divinputCargoventaTipoDelete);
                    }
                    // Si el formulario ya tiene el input de idlugarinventario lo eliminamos
                    if(document.getElementById('divinputCargoventaFecha')){
                        var divinputCargoventaFechaDelete = document.getElementById("divinputCargoventaFecha");
                        divinputCargoventaFechaDelete.parentNode.removeChild(divinputCargoventaFechaDelete);
                    }
                    // Creamos nuestro Formulario con los datos a insertar en Cargoventa
                    var form = document.getElementById('CargoventaForm');

                    // Actializar existencias
                    // Creamos el input de idlugarinventario y le seteamos el valor que le corresponde
                    var divinputIdordencompradetalle = document.createElement('div');
                    divinputIdordencompradetalle.className = "input-field";
                    divinputIdordencompradetalle.setAttribute ( 'id', 'divinputIdordencompradetalle' );
                    var inputIdordencompradetalle = document.createElement('input');
                    inputIdordencompradetalle.setAttribute ( 'id', 'idordencompradetalle' );
                    inputIdordencompradetalle.setAttribute ( 'type', 'hidden' );
                    inputIdordencompradetalle.setAttribute ( 'name', 'idordencompradetalle' );
                    inputIdordencompradetalle.setAttribute ( 'value', values.idordencompradetalle );
                    divinputIdordencompradetalle.appendChild(inputIdordencompradetalle)
                    // Actializar existencias

                    // Creamos el input de idlugarinventario y le seteamos el valor que le corresponde
                    var divinputIdlugarinventario = document.createElement('div');
                    divinputIdlugarinventario.className = "input-field";
                    divinputIdlugarinventario.setAttribute ( 'id', 'divinputIdlugarinventario' );
                    var inputIdlugarinventario = document.createElement('input');
                    inputIdlugarinventario.setAttribute ( 'id', 'idlugarinventario' );
                    inputIdlugarinventario.setAttribute ( 'type', 'hidden' );
                    inputIdlugarinventario.setAttribute ( 'name', 'idlugarinventario' );
                    inputIdlugarinventario.setAttribute ( 'value', values.idlugarinventario );
                    divinputIdlugarinventario.appendChild(inputIdlugarinventario)
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaTipo = document.createElement('div');
                    divinputCargoventaTipo.className = "input-field";
                    divinputCargoventaTipo.setAttribute ( 'id', 'divinputCargoventaTipo' );
                    var inputCargoventaTipo = document.createElement('input');
                    inputCargoventaTipo.setAttribute ( 'id', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'type', 'hidden' );
                    inputCargoventaTipo.setAttribute ( 'name', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'value', values.cargoventa_tipo );
                    divinputCargoventaTipo.appendChild(inputCargoventaTipo);
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaFecha = document.createElement('div');
                    divinputCargoventaFecha.className = "input-field";
                    divinputCargoventaFecha.setAttribute ( 'id', 'divinputCargoventaFecha' );
                    var inputCargoventaFecha = document.createElement('input');
                    inputCargoventaFecha.setAttribute ( 'id', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'type', 'hidden' );
                    inputCargoventaFecha.setAttribute ( 'name', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'value', values.cargoventa_fecha );
                    divinputCargoventaFecha.appendChild(inputCargoventaFecha);
                    form.appendChild(divinputCargoventaFecha);
                    form.appendChild(divinputCargoventaTipo);
                    form.appendChild(divinputIdlugarinventario);
                    form.appendChild(divinputIdordencompradetalle);
                }

                // Si dan clic a una entidad de la colección
                $("#entidadArticulo-"+values.idordencompradetalle).click(function(){
                    if ($('#fieldsetCargoventaArticulo').hasClass('hiddendiv')){
                        $('#fieldsetCargoventaArticulo').removeClass('hiddendiv')
                    }
                    var br   = document.createElement("br");
                    var br2   = document.createElement("br");
                    var br3   = document.createElement("br");
                    var br4   = document.createElement("br");
                    var br5   = document.createElement("br");
                    // Creamos el input de cantidad de tipo select
                    var divinputCantidad = document.createElement('div');
                    divinputCantidad.className = "input-field";
                    divinputCantidad.setAttribute ( 'id', 'divinputCantidad' );
                    var select = document.createElement('select');
                    select.style.display = "inline";
                    select.style.width = "auto";
                    select.style.height = "auto";
                    select.setAttribute ( 'id', 'cantidad' );
                    // agregamos los valores <option> a seleccionar
                    for($i=1; $i<=values.existencia; $i++){
                        var selectOption = new Option($i,$i);
                        select.appendChild(selectOption);
                    }
                    // agregamos las options en nuestro select
                    divinputCantidad.appendChild(select);

                    // Creamos la entidad textual lista para agregar al cargoventa
                    var div = document.getElementById("fieldsetCargoventaArticuloEntity");
                    div.innerHTML = div.dir;
                    var textoArticulo = document.createTextNode("Artículo: "+values.articulo);
                    var textoDescripcion = document.createTextNode("Descrpción: "+values.descripcion);
                    var textoCaducidad = document.createTextNode("Caducidad: "+values.caducidad);
                    var textoDisponibleEn = document.createTextNode("Disponible en: "+values.salida);
                    var textoExistencia = document.createTextNode("Existencias: "+values.existencia);
                    var textoCantidad = document.createTextNode("Cantidad: ");
                    div.appendChild(textoArticulo);
                    div.appendChild(br);
                    div.appendChild(textoDescripcion);
                    div.appendChild(br2);
                    div.appendChild(textoCaducidad);
                    div.appendChild(br3);
                    div.appendChild(textoDisponibleEn);
                    div.appendChild(br4);
                    div.appendChild(textoExistencia);
                    div.appendChild(br5);
                    div.appendChild(textoCantidad);
                    div.appendChild(select);

                    // Actializar existencias

                    // El input ordencompradetalle solamente lo necesitamos para actualizar nuestra entidad artículo antes de agregar el cargo.
                    // Si el formulario ya tiene el input de idordencompradetalle lo eliminamos
                    if(document.getElementById('divinputIdordencompradetalle')){
                        var divinputIdordencompradetalleDelete = document.getElementById("divinputIdordencompradetalle");
                        divinputIdordencompradetalleDelete.parentNode.removeChild(divinputIdordencompradetalleDelete);
                    }
                    // Actializar existencias

                    // Si el formulario ya tiene el input de idlugarinventario lo eliminamos
                    if(document.getElementById('divinputIdlugarinventario')){
                        var divinputIdlugarinventarioDelete = document.getElementById("divinputIdlugarinventario");
                        divinputIdlugarinventarioDelete.parentNode.removeChild(divinputIdlugarinventarioDelete);
                    }
                    // Si el formulario ya tiene el input de idlugarinventario lo eliminamos
                    if(document.getElementById('divinputCargoventaTipo')){
                        var divinputCargoventaTipoDelete = document.getElementById("divinputCargoventaTipo");
                        divinputCargoventaTipoDelete.parentNode.removeChild(divinputCargoventaTipoDelete);
                    }
                    // Si el formulario ya tiene el input de idlugarinventario lo eliminamos
                    if(document.getElementById('divinputCargoventaFecha')){
                        var divinputCargoventaFechaDelete = document.getElementById("divinputCargoventaFecha");
                        divinputCargoventaFechaDelete.parentNode.removeChild(divinputCargoventaFechaDelete);
                    }
                    // Creamos nuestro Formulario con los datos a insertar en Cargoventa
                    var form = document.getElementById('CargoventaForm');

                    // Actializar existencias
                    // Creamos el input de idlugarinventario y le seteamos el valor que le corresponde
                    var divinputIdordencompradetalle = document.createElement('div');
                    divinputIdordencompradetalle.className = "input-field";
                    divinputIdordencompradetalle.setAttribute ( 'id', 'divinputIdordencompradetalle' );
                    var inputIdordencompradetalle = document.createElement('input');
                    inputIdordencompradetalle.setAttribute ( 'id', 'idordencompradetalle' );
                    inputIdordencompradetalle.setAttribute ( 'type', 'hidden' );
                    inputIdordencompradetalle.setAttribute ( 'name', 'idordencompradetalle' );
                    inputIdordencompradetalle.setAttribute ( 'value', values.idordencompradetalle );
                    divinputIdordencompradetalle.appendChild(inputIdordencompradetalle)
                    // Actializar existencias

                    // Creamos el input de idlugarinventario y le seteamos el valor que le corresponde
                    var divinputIdlugarinventario = document.createElement('div');
                    divinputIdlugarinventario.className = "input-field";
                    divinputIdlugarinventario.setAttribute ( 'id', 'divinputIdlugarinventario' );
                    var inputIdlugarinventario = document.createElement('input');
                    inputIdlugarinventario.setAttribute ( 'id', 'idlugarinventario' );
                    inputIdlugarinventario.setAttribute ( 'type', 'hidden' );
                    inputIdlugarinventario.setAttribute ( 'name', 'idlugarinventario' );
                    inputIdlugarinventario.setAttribute ( 'value', values.idlugarinventario );
                    divinputIdlugarinventario.appendChild(inputIdlugarinventario)
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaTipo = document.createElement('div');
                    divinputCargoventaTipo.className = "input-field";
                    divinputCargoventaTipo.setAttribute ( 'id', 'divinputCargoventaTipo' );
                    var inputCargoventaTipo = document.createElement('input');
                    inputCargoventaTipo.setAttribute ( 'id', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'type', 'hidden' );
                    inputCargoventaTipo.setAttribute ( 'name', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'value', values.cargoventa_tipo );
                    divinputCargoventaTipo.appendChild(inputCargoventaTipo);
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaFecha = document.createElement('div');
                    divinputCargoventaFecha.className = "input-field";
                    divinputCargoventaFecha.setAttribute ( 'id', 'divinputCargoventaFecha' );
                    var inputCargoventaFecha = document.createElement('input');
                    inputCargoventaFecha.setAttribute ( 'id', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'type', 'hidden' );
                    inputCargoventaFecha.setAttribute ( 'name', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'value', values.cargoventa_fecha );
                    divinputCargoventaFecha.appendChild(inputCargoventaFecha);
                    form.appendChild(divinputCargoventaFecha);
                    form.appendChild(divinputCargoventaTipo);
                    form.appendChild(divinputIdlugarinventario);
                    form.appendChild(divinputIdordencompradetalle);
                });
            });
        },
        error: function(){
            $('#modalCargoventaArticulo').prepend('<div class="card-panel #00086E-text red accent-2 guardado-ajax">Error al intentar buscar</div>')
        }
    });

    return false;
};
function buscarCargoventaServicio(idservicio){

    //Obtenemos el valor del selector de lugarinventario
    var busquedaServicio = $("input#busquedaServicio").val();

    //Obtenemos el valor del selector de lugarinventario
    var cargoventaservicio_by = $("select#cargoventaservicio_by").val();
    //Validamos el campo idlugarinventario, simplemente miramos que no esté vacío
    if (cargoventaservicio_by == "") {
        if ($('span#cargoventaservicio_by_error').hasClass('hidden')){
            $('span#cargoventaservicio_by_error').removeClass('hidden');
            $("span#cargoventaservicio_by_error").show();
            $("span#cargoventaservicio_by").focus();
        }
        return false;
    }else{
        $("span#cargoventaservicio_by_error").hide();
    }

    //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
    var dataString = 'cargoventaservicio_by=' + cargoventaservicio_by + '&busquedaServicio=' + busquedaServicio ;

    $.ajax({
        type: "POST",
        url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
        dataType : 'json',
        data: dataString,
        jsonpCallback: 'callback',
        success: function(data) {
            servicioArray = []
            var servicioEntity = data.servicioArray
            $.each( servicioEntity, function( key, value ) {
                servicioArray.push({
                    "idservicio" : value.idservicio,
                    "cargoventa_tipo" : value.cargoventa_tipo,
                    "cargoventa_fecha" : value.cargoventa_fecha,
                    "servicio_nombre" : value.servicio_nombre,
                    "servicio_descripcion" : value.servicio_descripcion,
                    "servicio_precio" : value.servicio_precio
                });
            });

            // Creamos nuestra tabla de colecciones
            generaTablaBuscarVentaServicio(servicioArray);

            // Seleccionamos un item de nuestra tabla de colecciones y construimos la entidad para agregarla como cargoventa
            $.each(servicioArray, function(keys, values){
                // Mantenemos el foco en el servicio que se esta agregando
                if(idservicio == values.idservicio){
                    if ($('#fieldsetCargoventaServicio').hasClass('hiddendiv')){
                        $('#fieldsetCargoventaServicio').removeClass('hiddendiv')
                    }
                    var br   = document.createElement("br");
                    var br2   = document.createElement("br");
                    var br3   = document.createElement("br");
                    var br4   = document.createElement("br");
                    // Creamos el input de cantidad de tipo input
                    var divinputCantidad = document.createElement('div');
                    divinputCantidad.className = "input-field";
                    divinputCantidad.setAttribute ( 'id', 'divinputCantidad' );
                    var inputCantidad = document.createElement('input');
                    inputCantidad.setAttribute ( 'id', 'cantidad' );
                    inputCantidad.style.width = "20%";
                    inputCantidad.type = "number";
                    inputCantidad.min ="1";
                    inputCantidad.max = "999999999";
                    divinputCantidad.appendChild(inputCantidad);

                    // Creamos la entidad textual lista para agregar al cargoventa
                    var div = document.getElementById("fieldsetCargoventaServicioEntity");
                    div.innerHTML = div.dir;
                    var textoServicioNombre = document.createTextNode("Servicio: "+values.servicio_nombre);
                    var textoServicioDescripcion = document.createTextNode("Descrpción: "+values.servicio_descripcion);
                    var textoServicioPrecio = document.createTextNode("Precio: "+values.servicio_precio);
                    var textoCargoventaFecha = document.createTextNode("Fecha: "+values.cargoventa_fecha);
                    var textoCantidad = document.createTextNode("Cantidad: ");
                    div.appendChild(textoServicioNombre);
                    div.appendChild(br);
                    div.appendChild(textoServicioDescripcion);
                    div.appendChild(br2);
                    div.appendChild(textoServicioPrecio);
                    div.appendChild(br3);
                    div.appendChild(textoCargoventaFecha);
                    div.appendChild(br4);
                    div.appendChild(textoCantidad);
                    div.appendChild(inputCantidad);

                    // El input idservicio solamente lo necesitamos para actualizar nuestra entidad servicio antes de agregar el cargo.
                    // Si el formulario ya tiene el input de idservicio lo eliminamos
                    if(document.getElementById('divinputIdservicio')){
                        var divinputIdservicioDelete = document.getElementById("divinputIdservicio");
                        divinputIdservicioDelete.parentNode.removeChild(divinputIdservicioDelete);
                    }

                    // Si el formulario ya tiene el input de servicio_nombre lo eliminamos
                    if(document.getElementById('divinputCargoventaTipo')){
                        var divinputCargoventaTipoDelete = document.getElementById("divinputCargoventaTipo");
                        divinputCargoventaTipoDelete.parentNode.removeChild(divinputCargoventaTipoDelete);
                    }
                    // Si el formulario ya tiene el input de servicio_descripcion lo eliminamos
                    if(document.getElementById('divinputCargoventaFecha')){
                        var divinputCargoventaFechaDelete = document.getElementById("divinputCargoventaFecha");
                        divinputCargoventaFechaDelete.parentNode.removeChild(divinputCargoventaFechaDelete);
                    }

                    // Creamos nuestro Formulario con los datos a insertar en Cargoventa
                    var form = document.getElementById('CargoventaForm');
                    // Creamos el input de idlugarinventario y le seteamos el valor que le corresponde
                    var divinputIdservicio = document.createElement('div');
                    divinputIdservicio.className = "input-field";
                    divinputIdservicio.setAttribute ( 'id', 'divinputIdservicio' );
                    var inputIdservicio = document.createElement('input');
                    inputIdservicio.setAttribute ( 'id', 'idservicio' );
                    inputIdservicio.setAttribute ( 'type', 'hidden' );
                    inputIdservicio.setAttribute ( 'name', 'idservicio' );
                    inputIdservicio.setAttribute ( 'value', values.idservicio );
                    divinputIdservicio.appendChild(inputIdservicio)
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaTipo = document.createElement('div');
                    divinputCargoventaTipo.className = "input-field";
                    divinputCargoventaTipo.setAttribute ( 'id', 'divinputCargoventaTipo' );
                    var inputCargoventaTipo = document.createElement('input');
                    inputCargoventaTipo.setAttribute ( 'id', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'type', 'hidden' );
                    inputCargoventaTipo.setAttribute ( 'name', 'cargoventa_tipo' );
                    inputCargoventaTipo.setAttribute ( 'value', values.cargoventa_tipo );
                    divinputCargoventaTipo.appendChild(inputCargoventaTipo);
                    // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                    var divinputCargoventaFecha = document.createElement('div');
                    divinputCargoventaFecha.className = "input-field";
                    divinputCargoventaFecha.setAttribute ( 'id', 'divinputCargoventaFecha' );
                    var inputCargoventaFecha = document.createElement('input');
                    inputCargoventaFecha.setAttribute ( 'id', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'type', 'hidden' );
                    inputCargoventaFecha.setAttribute ( 'name', 'cargoventa_fecha' );
                    inputCargoventaFecha.setAttribute ( 'value', values.cargoventa_fecha );
                    divinputCargoventaFecha.appendChild(inputCargoventaFecha);
                    form.appendChild(divinputCargoventaFecha);
                    form.appendChild(divinputCargoventaTipo);
                    form.appendChild(divinputIdservicio);
                }

                // Si dan clic a una entidad de la colección

                // Seleccionamos un item de nuestra tabla de colecciones y construimos la entidad para agregarla como cargoventa
                $.each(servicioArray, function(keys, values){
                    // Si dan clic a una entidad de la colección
                    $("#entidadServicio-"+values.idservicio).click(function(){
                        if ($('#fieldsetCargoventaServicio').hasClass('hiddendiv')){
                            $('#fieldsetCargoventaServicio').removeClass('hiddendiv')
                        }
                        var br   = document.createElement("br");
                        var br2   = document.createElement("br");
                        var br3   = document.createElement("br");
                        var br4   = document.createElement("br");
                        // Creamos el input de cantidad de tipo input
                        var divinputCantidad = document.createElement('div');
                        divinputCantidad.className = "input-field";
                        divinputCantidad.setAttribute ( 'id', 'divinputCantidad' );
                        var inputCantidad = document.createElement('input');
                        inputCantidad.setAttribute ( 'id', 'cantidad' );
                        inputCantidad.style.width = "20%";
                        inputCantidad.type = "number";
                        inputCantidad.min ="1";
                        inputCantidad.max = "999999999";
                        divinputCantidad.appendChild(inputCantidad);

                        // Creamos la entidad textual lista para agregar al cargoventa
                        var div = document.getElementById("fieldsetCargoventaServicioEntity");
                        div.innerHTML = div.dir;
                        var textoServicioNombre = document.createTextNode("Servicio: "+values.servicio_nombre);
                        var textoServicioDescripcion = document.createTextNode("Descrpción: "+values.servicio_descripcion);
                        var textoServicioPrecio = document.createTextNode("Precio: "+values.servicio_precio);
                        var textoCargoventaFecha = document.createTextNode("Fecha: "+values.cargoventa_fecha);
                        var textoCantidad = document.createTextNode("Cantidad: ");
                        div.appendChild(textoServicioNombre);
                        div.appendChild(br);
                        div.appendChild(textoServicioDescripcion);
                        div.appendChild(br2);
                        div.appendChild(textoServicioPrecio);
                        div.appendChild(br3);
                        div.appendChild(textoCargoventaFecha);
                        div.appendChild(br4);
                        div.appendChild(textoCantidad);
                        div.appendChild(inputCantidad);

                        // El input idservicio solamente lo necesitamos para actualizar nuestra entidad servicio antes de agregar el cargo.
                        // Si el formulario ya tiene el input de idservicio lo eliminamos
                        if(document.getElementById('divinputIdservicio')){
                            var divinputIdservicioDelete = document.getElementById("divinputIdservicio");
                            divinputIdservicioDelete.parentNode.removeChild(divinputIdservicioDelete);
                        }

                        // Si el formulario ya tiene el input de servicio_nombre lo eliminamos
                        if(document.getElementById('divinputCargoventaTipo')){
                            var divinputCargoventaTipoDelete = document.getElementById("divinputCargoventaTipo");
                            divinputCargoventaTipoDelete.parentNode.removeChild(divinputCargoventaTipoDelete);
                        }
                        // Si el formulario ya tiene el input de servicio_descripcion lo eliminamos
                        if(document.getElementById('divinputCargoventaFecha')){
                            var divinputCargoventaFechaDelete = document.getElementById("divinputCargoventaFecha");
                            divinputCargoventaFechaDelete.parentNode.removeChild(divinputCargoventaFechaDelete);
                        }

                        // Creamos nuestro Formulario con los datos a insertar en Cargoventa
                        var form = document.getElementById('CargoventaForm');
                        // Creamos el input de idlugarinventario y le seteamos el valor que le corresponde
                        var divinputIdservicio = document.createElement('div');
                        divinputIdservicio.className = "input-field";
                        divinputIdservicio.setAttribute ( 'id', 'divinputIdservicio' );
                        var inputIdservicio = document.createElement('input');
                        inputIdservicio.setAttribute ( 'id', 'idservicio' );
                        inputIdservicio.setAttribute ( 'type', 'hidden' );
                        inputIdservicio.setAttribute ( 'name', 'idservicio' );
                        inputIdservicio.setAttribute ( 'value', values.idservicio );
                        divinputIdservicio.appendChild(inputIdservicio)
                        // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                        var divinputCargoventaTipo = document.createElement('div');
                        divinputCargoventaTipo.className = "input-field";
                        divinputCargoventaTipo.setAttribute ( 'id', 'divinputCargoventaTipo' );
                        var inputCargoventaTipo = document.createElement('input');
                        inputCargoventaTipo.setAttribute ( 'id', 'cargoventa_tipo' );
                        inputCargoventaTipo.setAttribute ( 'type', 'hidden' );
                        inputCargoventaTipo.setAttribute ( 'name', 'cargoventa_tipo' );
                        inputCargoventaTipo.setAttribute ( 'value', values.cargoventa_tipo );
                        divinputCargoventaTipo.appendChild(inputCargoventaTipo);
                        // Creamos el input de cargoventa_tipo y le seteamos el valor que le corresponde
                        var divinputCargoventaFecha = document.createElement('div');
                        divinputCargoventaFecha.className = "input-field";
                        divinputCargoventaFecha.setAttribute ( 'id', 'divinputCargoventaFecha' );
                        var inputCargoventaFecha = document.createElement('input');
                        inputCargoventaFecha.setAttribute ( 'id', 'cargoventa_fecha' );
                        inputCargoventaFecha.setAttribute ( 'type', 'hidden' );
                        inputCargoventaFecha.setAttribute ( 'name', 'cargoventa_fecha' );
                        inputCargoventaFecha.setAttribute ( 'value', values.cargoventa_fecha );
                        divinputCargoventaFecha.appendChild(inputCargoventaFecha);
                        form.appendChild(divinputCargoventaFecha);
                        form.appendChild(divinputCargoventaTipo);
                        form.appendChild(divinputIdservicio);
                    });
                });
            });
        },
        error: function(){
            $('#modalCargoventaServicio').prepend('<div class="card-panel #00086E-text red accent-2 guardado-ajax">Error al intentar buscar</div>')
        }
    });

    return false;
};

function tablaCargoventaArticuloAgregado(cargoventaArray) {

    // Obtener la referencia del elemento div con id = cargoventaArticuloResult
    var div = document.getElementById("cargoventaArticuloResult");
    div.innerHTML = div.dir;
    // Crea un elemento <table> y un elemento <tbody>
    var tabla   = document.createElement("table");
    tabla.className = "hoverable striped";
    var tblHead = document.createElement("thead");
    var tblBody = document.createElement("tbody");

    var thArray = ['Cantidad', 'Artículo', 'Descripción', 'Salida', 'Fecha/hora', 'Precio', 'Subtotal', 'Opciones']

    // Crea las celdas
    for (var i = 0; i < 1; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("th");
            var textoCelda = document.createTextNode(thArray[j]);
            celda.appendChild(textoCelda);
            hilera.appendChild(celda);
        }

        // agrega la hilera al final de la tabla (al final del elemento tblHead)
        tblHead.appendChild(hilera);
    }

    // posiciona el <thead> debajo del elemento <tbody>
    tabla.appendChild(tblHead);

    // Crea las celdas
    for (var i = 0; i < cargoventaArray.length; i++) {

        var subTotalArticulo = parseFloat(cargoventaArray[i]["subtotal"]);
        var status = cargoventaArray[i]["status"];

        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("td");

            if(j == 0){
                var textoCelda = document.createTextNode(cargoventaArray[i]["cantidad"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 1){
                var textoCelda = document.createTextNode(cargoventaArray[i]["articulo"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 2){
                var textoCelda = document.createTextNode(cargoventaArray[i]["descripcion"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 3){
                var textoCelda = document.createTextNode(cargoventaArray[i]["salida"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 4){
                var textoCelda = document.createTextNode(cargoventaArray[i]["fechahora"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 5){
                var textoCelda = document.createTextNode(cargoventaArray[i]["precio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 6){
                var textoCelda = document.createTextNode(cargoventaArray[i]["subtotal"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 7){

                var link1 = document.createElement("a");
                link1.className = "modal-trigger";
                link1.setAttribute ( 'data-position', 'left' );
                link1.setAttribute ( 'data-tooltip', 'VisualizarVenta' );
                link1.setAttribute ( 'href', '#view-modal-cargoventa-'+cargoventaArray[i]["idcargoventa"] );
                var vista = document.createElement("i");
                vista.className = "green-text text-darken-2 tiny mdi-image-remove-red-eye pointer";

                var link3 = document.createElement("a");
                link3.className = "tooltipped modal-trigger";
                link3.setAttribute ( 'data-position', 'right' );
                link3.setAttribute ( 'data-tooltip', 'EliminarVenta' );
                link3.setAttribute ( 'href', '#delete-modal-cargoventa-'+cargoventaArray[i]["idcargoventa"] );
                var eliminar = document.createElement("i");
                eliminar.className = "red-text text-darken-2 tiny mdi-action-delete pointer";
                link1.appendChild(vista);
                celda.appendChild(link1);
                link3.appendChild(eliminar);
                celda.appendChild(link3);
                hilera.appendChild(celda);
                <!-- Modal Trigger -->

                <!-- View Modal Structure -->
                var divcargosVenta = document.getElementById('cargosVenta')
                var divViewModalCargoventa = document.createElement('div')
                divViewModalCargoventa.className = "modal bottom-sheet";
                divViewModalCargoventa.setAttribute ( 'id', 'view-modal-cargoventa-'+cargoventaArray[i]["idcargoventa"]);
                var h4 = document.createElement('h4')
                var texth4 = document.createTextNode("Cargo-venta");
                h4.appendChild(texth4);
                var br = document.createElement('br')
                var divRow = document.createElement('div')
                divRow.className = "row";
                var fieldset = document.createElement('fieldset')
                var legend = document.createElement('legend')
                var textlegend = document.createTextNode("Datos generales");
                legend.appendChild(textlegend);
                var divCol1 = document.createElement('div')
                divCol1.className = "col s4";
                var divLabelContainer1 = document.createElement('div')
                divLabelContainer1.className = "label-container";
                var label1 = document.createElement('label')
                var textlabel1 = document.createTextNode("Cantidad:");
                label1.appendChild(textlabel1);
                var p1 = document.createElement('p')
                var textp1 = document.createTextNode(cargoventaArray[i]["cantidad"]);
                p1.appendChild(textp1);
                divLabelContainer1.appendChild(label1);
                divLabelContainer1.appendChild(p1);
                divCol1.appendChild(divLabelContainer1);
                var divCol2 = document.createElement('div')
                divCol2.className = "col s4";
                var divLabelContainer2 = document.createElement('div')
                divLabelContainer2.className = "label-container";
                var label2 = document.createElement('label')
                var textlabel2 = document.createTextNode("Artículo:");
                label2.appendChild(textlabel2);
                var p2 = document.createElement('p')
                var textp2 = document.createTextNode(cargoventaArray[i]["articulo"]);
                p2.appendChild(textp2);
                divLabelContainer2.appendChild(label2);
                divLabelContainer2.appendChild(p2);
                divCol2.appendChild(divLabelContainer2);
                var divCol3 = document.createElement('div')
                divCol3.className = "col s4";
                var divLabelContainer3 = document.createElement('div')
                divLabelContainer3.className = "label-container";
                var label3 = document.createElement('label')
                var textlabel3 = document.createTextNode("Descripción:");
                label3.appendChild(textlabel3);
                var p3 = document.createElement('p')
                var textp3 = document.createTextNode(cargoventaArray[i]["descripcion"]);
                p3.appendChild(textp3);
                divLabelContainer3.appendChild(label3);
                divLabelContainer3.appendChild(p3);
                divCol3.appendChild(divLabelContainer3);
                var divCol4 = document.createElement('div')
                divCol4.className = "col s4";
                var divLabelContainer4 = document.createElement('div')
                divLabelContainer4.className = "label-container";
                var label4 = document.createElement('label')
                var textlabel4 = document.createTextNode("Salida:");
                label4.appendChild(textlabel4);
                var p4 = document.createElement('p')
                var textp4 = document.createTextNode(cargoventaArray[i]["salida"]);
                p4.appendChild(textp4);
                divLabelContainer4.appendChild(label4);
                divLabelContainer4.appendChild(p4);
                divCol4.appendChild(divLabelContainer4);
                var divCol5 = document.createElement('div')
                divCol5.className = "col s4";
                var divLabelContainer5 = document.createElement('div')
                divLabelContainer5.className = "label-container";
                var label5 = document.createElement('label')
                var textlabel5 = document.createTextNode("Fecha/Hora:");
                label5.appendChild(textlabel5);
                var p5 = document.createElement('p')
                var textp5 = document.createTextNode(cargoventaArray[i]["fechahora"]);
                p5.appendChild(textp5);
                divLabelContainer5.appendChild(label5);
                divLabelContainer5.appendChild(p5);
                divCol5.appendChild(divLabelContainer5);
                var divCol6 = document.createElement('div')
                divCol6.className = "col s4";
                var divLabelContainer6 = document.createElement('div')
                divLabelContainer6.className = "label-container";
                var label6 = document.createElement('label')
                var textlabel6 = document.createTextNode("Precio:");
                label6.appendChild(textlabel6);
                var p6 = document.createElement('p')
                var textp6 = document.createTextNode(cargoventaArray[i]["precio"]);
                p6.appendChild(textp6);
                divLabelContainer6.appendChild(label6);
                divLabelContainer6.appendChild(p6);
                divCol6.appendChild(divLabelContainer6);
                var divCol7 = document.createElement('div')
                divCol7.className = "col s12";
                var divLabelContainer7 = document.createElement('div')
                divLabelContainer7.className = "label-container";
                var label7 = document.createElement('label')
                var textlabel7 = document.createTextNode("Subtotal:");
                label7.appendChild(textlabel7);
                var p7 = document.createElement('p')
                var textp7 = document.createTextNode(cargoventaArray[i]["subtotal"]);
                p7.appendChild(textp7);
                divLabelContainer7.appendChild(label7);
                divLabelContainer7.appendChild(p7);
                divCol7.appendChild(divLabelContainer7);
                fieldset.appendChild(divCol1);
                fieldset.appendChild(divCol2);
                fieldset.appendChild(divCol3);
                fieldset.appendChild(divCol4);
                fieldset.appendChild(divCol5);
                fieldset.appendChild(divCol6);
                fieldset.appendChild(divCol7);
                fieldset.appendChild(legend);
                divRow.appendChild(fieldset);
                var divViewModalFooter = document.createElement('div')
                divViewModalFooter.className = "modal-footer";
                var linkCerrar = document.createElement('a')
                linkCerrar.className = "modal-action modal-close waves-effect waves-light btn cerrar";
                var iconCerrar = document.createElement('i')
                iconCerrar.className = "mdi-navigation-close left";
                var textoIconCerrar = document.createTextNode('Cerrar');
                iconCerrar.appendChild(textoIconCerrar);
                linkCerrar.appendChild(iconCerrar);
                divViewModalFooter.appendChild(linkCerrar);
                divViewModalCargoventa.appendChild(br);
                divViewModalCargoventa.appendChild(h4);
                divViewModalCargoventa.appendChild(divRow);
                divViewModalCargoventa.appendChild(divViewModalFooter);
                divcargosVenta.appendChild(divViewModalCargoventa);
                <!-- End View Modal Structure -->

                <!-- Start Delete Structure -->
                var divcargosVentaDelete = document.getElementById('cargosVenta')
                var divDeleteModalCargoventaDelete = document.createElement('div')
                divDeleteModalCargoventaDelete.className = "modal";
                divDeleteModalCargoventaDelete.setAttribute ( 'id', 'delete-modal-cargoventa-'+cargoventaArray[i]["idcargoventa"]);
                var divDeleteModalContentCargoventaDelete = document.createElement('div')
                divDeleteModalContentCargoventaDelete.setAttribute ( 'id', 'delete-modal-cargoventa');
                divDeleteModalContentCargoventaDelete.className = "modal-content";

                var divRowDelete = document.createElement('div')
                divRowDelete.setAttribute ( 'id', 'delete-modal-header-container');
                divRowDelete.className = "row";
                var divRowAtencionDelete = document.createElement('div')
                divRowAtencionDelete.className = "col s4 offset-s4";
                var h4Delete = document.createElement('h4')
                var iDelete = document.createElement('i')
                iDelete.className = "mdi-alert-warning";
                var textoiDelete = document.createTextNode("ATENCION");
                iDelete.appendChild(textoiDelete);
                h4Delete.appendChild(iDelete);
                divRowAtencionDelete.appendChild(h4Delete);
                divRowDelete.appendChild(divRowAtencionDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRowDelete)

                var divRow2Delete = document.createElement('div')
                divRow2Delete.className = "row";
                var fieldsetDelete = document.createElement('fieldset')
                var legendDelete = document.createElement('legend')
                var textlegendDelete = document.createTextNode("Datos generales");
                legendDelete.appendChild(textlegendDelete);
                var divCol1Delete = document.createElement('div')
                divCol1Delete.className = "col s4";
                var divLabelContainer1Delete = document.createElement('div')
                divLabelContainer1Delete.className = "label-container";
                var label1Delete = document.createElement('label')
                var textlabel1Delete = document.createTextNode("Cantidad:");
                label1Delete.appendChild(textlabel1Delete);
                var p1Delete = document.createElement('p')
                var textp1Delete = document.createTextNode(cargoventaArray[i]["cantidad"]);
                p1Delete.appendChild(textp1Delete);
                divLabelContainer1Delete.appendChild(label1Delete);
                divLabelContainer1Delete.appendChild(p1Delete);
                divCol1Delete.appendChild(divLabelContainer1Delete);
                var divCol2Delete = document.createElement('div')
                divCol2Delete.className = "col s4";
                var divLabelContainer2Delete = document.createElement('div')
                divLabelContainer2Delete.className = "label-container";
                var label2Delete = document.createElement('label')
                var textlabel2Delete = document.createTextNode("Artículo:");
                label2Delete.appendChild(textlabel2Delete);
                var p2Delete = document.createElement('p')
                var textp2Delete = document.createTextNode(cargoventaArray[i]["articulo"]);
                p2Delete.appendChild(textp2Delete);
                divLabelContainer2Delete.appendChild(label2Delete);
                divLabelContainer2Delete.appendChild(p2Delete);
                divCol2Delete.appendChild(divLabelContainer2Delete);
                var divCol3Delete = document.createElement('div')
                divCol3Delete.className = "col s4";
                var divLabelContainer3Delete = document.createElement('div')
                divLabelContainer3Delete.className = "label-container";
                var label3Delete = document.createElement('label')
                var textlabel3Delete = document.createTextNode("Descripción:");
                label3Delete.appendChild(textlabel3Delete);
                var p3Delete = document.createElement('p')
                var textp3Delete = document.createTextNode(cargoventaArray[i]["descripcion"]);
                p3Delete.appendChild(textp3Delete);
                divLabelContainer3Delete.appendChild(label3Delete);
                divLabelContainer3Delete.appendChild(p3Delete);
                divCol3Delete.appendChild(divLabelContainer3Delete);
                var divCol4Delete = document.createElement('div')
                divCol4Delete.className = "col s4";
                var divLabelContainer4Delete = document.createElement('div')
                divLabelContainer4Delete.className = "label-container";
                var label4Delete = document.createElement('label')
                var textlabel4Delete = document.createTextNode("Salida:");
                label4Delete.appendChild(textlabel4Delete);
                var p4Delete = document.createElement('p')
                var textp4Delete = document.createTextNode(cargoventaArray[i]["salida"]);
                p4Delete.appendChild(textp4Delete);
                divLabelContainer4Delete.appendChild(label4Delete);
                divLabelContainer4Delete.appendChild(p4Delete);
                divCol4Delete.appendChild(divLabelContainer4Delete);
                var divCol5Delete = document.createElement('div')
                divCol5Delete.className = "col s4";
                var divLabelContainer5Delete = document.createElement('div')
                divLabelContainer5Delete.className = "label-container";
                var label5Delete = document.createElement('label')
                var textlabel5Delete = document.createTextNode("Fecha/Hora:");
                label5Delete.appendChild(textlabel5Delete);
                var p5Delete = document.createElement('p')
                var textp5Delete = document.createTextNode(cargoventaArray[i]["fechahora"]);
                p5Delete.appendChild(textp5Delete);
                divLabelContainer5Delete.appendChild(label5Delete);
                divLabelContainer5Delete.appendChild(p5Delete);
                divCol5Delete.appendChild(divLabelContainer5Delete);
                var divCol6Delete = document.createElement('div')
                divCol6Delete.className = "col s4";
                var divLabelContainer6Delete = document.createElement('div')
                divLabelContainer6Delete.className = "label-container";
                var label6Delete = document.createElement('label')
                var textlabel6Delete = document.createTextNode("Precio:");
                label6Delete.appendChild(textlabel6Delete);
                var p6Delete = document.createElement('p')
                var textp6Delete = document.createTextNode(cargoventaArray[i]["precio"]);
                p6Delete.appendChild(textp6Delete);
                divLabelContainer6Delete.appendChild(label6Delete);
                divLabelContainer6Delete.appendChild(p6Delete);
                divCol6Delete.appendChild(divLabelContainer6Delete);
                var divCol7Delete = document.createElement('div')
                divCol7Delete.className = "col s12";
                var divLabelContainer7Delete = document.createElement('div')
                divLabelContainer7Delete.className = "label-container";
                var label7Delete = document.createElement('label')
                var textlabel7Delete = document.createTextNode("Subtotal:");
                label7Delete.appendChild(textlabel7Delete);
                var p7Delete = document.createElement('p')
                var textp7Delete = document.createTextNode(cargoventaArray[i]["subtotal"]);
                p7Delete.appendChild(textp7Delete);
                divLabelContainer7Delete.appendChild(label7Delete);
                divLabelContainer7Delete.appendChild(p7Delete);
                divCol7Delete.appendChild(divLabelContainer7Delete);
                fieldsetDelete.appendChild(divCol1Delete);
                fieldsetDelete.appendChild(divCol2Delete);
                fieldsetDelete.appendChild(divCol3Delete);
                fieldsetDelete.appendChild(divCol4Delete);
                fieldsetDelete.appendChild(divCol5Delete);
                fieldsetDelete.appendChild(divCol6Delete);
                fieldsetDelete.appendChild(divCol7Delete);
                fieldsetDelete.appendChild(legendDelete);
                divRow2Delete.appendChild(fieldsetDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRow2Delete)

                var divRow3Delete = document.createElement('div')
                divRow3Delete.className = "row";
                var divRowPreguntaDelete = document.createElement('div')
                divRowPreguntaDelete.className = "col s12";
                var h5Delete = document.createElement('h5')
                var textoi2Delete = document.createTextNode("¿Estás seguro que deseas eliminar el cargo?");
                h5Delete.appendChild(textoi2Delete);
                divRowPreguntaDelete.appendChild(h5Delete);
                divRow3Delete.appendChild(divRowPreguntaDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRow3Delete)

                divDeleteModalCargoventaDelete.appendChild(divDeleteModalContentCargoventaDelete);

                var divDeleteModalFooterDelete = document.createElement('div')
                divDeleteModalFooterDelete.className = "modal-footer";
                var linkCerrarDelete = document.createElement('a')
                linkCerrarDelete.className = "modal-action modal-close waves-effect waves-light btn cerrar";
                var iconCerrarDelete = document.createElement('i')
                iconCerrarDelete.className = "mdi-navigation-close left";
                var textoIconCerrarDelete = document.createTextNode('Cerrar');
                iconCerrarDelete.appendChild(textoIconCerrarDelete);
                linkCerrarDelete.appendChild(iconCerrarDelete);
                var linkEliminarDelete = document.createElement('a')
                linkEliminarDelete.setAttribute ( 'id', 'eliminarCargoventa'+cargoventaArray[i]["idcargoventa"]);
                linkEliminarDelete.className = "waves-effect waves-light btn eliminar";
                var iconEliminarDelete = document.createElement('i')
                iconEliminarDelete.className = "mdi-action-delete left";
                var textoIconEliminarDelete = document.createTextNode('Eliminar');
                iconEliminarDelete.appendChild(textoIconEliminarDelete);
                linkEliminarDelete.appendChild(iconEliminarDelete);

                divDeleteModalFooterDelete.appendChild(linkCerrarDelete);
                divDeleteModalFooterDelete.appendChild(linkEliminarDelete);
                divDeleteModalCargoventaDelete.appendChild(divDeleteModalFooterDelete);
                divcargosVentaDelete.appendChild(divDeleteModalCargoventaDelete);
                <!-- End Delete Modal Structure -->
            }
        }

        // agrega la hilera al final de la tabla (al final del elemento tblbody)
        tblBody.appendChild(hilera);

        var idcargoventa = cargoventaArray[i]["idcargoventa"]
        var idventa = cargoventaArray[i]["idventa"]
        var cantidad = cargoventaArray[i]["cantidad"]
    }

    // posiciona el <tbody> debajo del elemento <table>
    tabla.appendChild(tblBody);

    // appends <table> into <body>
    div.appendChild(tabla);

    // Si dan clic en eliminarCargoventa-id
    $("#eliminarCargoventa"+idcargoventa).click({idcargoventa:idcargoventa, idventa:idventa, cantidad:cantidad},function() {

        //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
        var dataString = 'eliminar_cargoventa_tipo=articulo' + '&idcargoventa=' + idcargoventa + '&idventa=' + idventa + '&cantidad=' + cantidad;

        $.ajax({
            type: "POST",
            url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
            dataType : 'json',
            data: dataString,
            jsonpCallback: 'callback',
            success: function(data) {
                alert("Se eliminó exitosamente el cargo de un articulo")

                cargoventaArray = []
                var cargoventaEntity = data.cargoventaArray
                if(cargoventaEntity){
                    $.each( cargoventaEntity, function( key, value ) {
                        cargoventaArray.push({
                            "idcargoventa" : value.idcargoventa,
                            "idventa" : value.idventa,
                            "status" : value.status,
                            "cantidad" : value.cantidad,
                            "articulo" : value.articulo,
                            "descripcion" : value.descripcion,
                            "salida" : value.salida,
                            "fechahora" : value.fechahora,
                            "precio" : value.precio,
                            "subtotal" : value.subtotal
                        });
                    });
                }

                tablaCargoventaArticuloEliminado(cargoventaArray)
                tablaCargoventaArticuloAgregadoModal(cargoventaArray)
                cargoventaEliminadoArray = []
                var cargoventaEliminado = data.cargoventaEliminadoArray
                if(cargoventaEliminado){
                    $.each( cargoventaEliminado, function( key, value ) {
                        cargoventaEliminadoArray.push({
                            "idcargoventa" : value.idcargoventa,
                            "idventa" : value.idventa,
                            "status" : value.status,
                            "cantidad" : value.cantidad,
                            "articulo" : value.articulo,
                            "descripcion" : value.descripcion,
                            "salida" : value.salida,
                            "fechahora" : value.fechahora,
                            "precio" : value.precio,
                            "subtotal" : value.subtotal
                        });
                    });
                }
                subTotalResponse(status, -(cargoventaEliminadoArray[0]['subtotal']), null, 'venta')
            },
            error: function(){
                alert("Error al intentar eliminar idcargoventa")
            }
        });
        return false;

    });

    subTotalResponse(status, subTotalArticulo, null, 'venta')

}

function tablaCargoventaArticuloEliminado(cargoventaArray) {

    // Obtener la referencia del elemento div con id = cargoventaArticuloResult
    var div = document.getElementById("cargoventaArticuloResult");
    div.innerHTML = div.dir;
    // Crea un elemento <table> y un elemento <tbody>
    var tabla   = document.createElement("table");
    tabla.className = "hoverable striped";
    var tblHead = document.createElement("thead");
    var tblBody = document.createElement("tbody");

    var thArray = ['Cantidad', 'Artículo', 'Descripción', 'Salida', 'Fecha/hora', 'Precio', 'Subtotal', 'Opciones']

    // Crea las celdas
    for (var i = 0; i < 1; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("th");
            var textoCelda = document.createTextNode(thArray[j]);
            celda.appendChild(textoCelda);
            hilera.appendChild(celda);
        }

        // agrega la hilera al final de la tabla (al final del elemento tblHead)
        tblHead.appendChild(hilera);
    }

    // posiciona el <thead> debajo del elemento <tbody>
    tabla.appendChild(tblHead);

    // Crea las celdas
    for (var i = 0; i < cargoventaArray.length; i++) {

        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("td");

            if(j == 0){
                var textoCelda = document.createTextNode(cargoventaArray[i]["cantidad"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 1){
                var textoCelda = document.createTextNode(cargoventaArray[i]["articulo"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 2){
                var textoCelda = document.createTextNode(cargoventaArray[i]["descripcion"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 3){
                var textoCelda = document.createTextNode(cargoventaArray[i]["salida"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 4){
                var textoCelda = document.createTextNode(cargoventaArray[i]["fechahora"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 5){
                var textoCelda = document.createTextNode(cargoventaArray[i]["precio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 6){
                var textoCelda = document.createTextNode(cargoventaArray[i]["subtotal"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 7){

                var link1 = document.createElement("a");
                link1.className = "modal-trigger";
                link1.setAttribute ( 'data-position', 'left' );
                link1.setAttribute ( 'data-tooltip', 'VisualizarVenta' );
                link1.setAttribute ( 'href', '#view-modal-cargoventa-'+cargoventaArray[i]["idcargoventa"] );
                var vista = document.createElement("i");
                vista.className = "green-text text-darken-2 tiny mdi-image-remove-red-eye pointer";

                var link3 = document.createElement("a");
                link3.className = "tooltipped modal-trigger";
                link3.setAttribute ( 'data-position', 'right' );
                link3.setAttribute ( 'data-tooltip', 'EliminarVenta' );
                link3.setAttribute ( 'href', '#delete-modal-cargoventa-'+cargoventaArray[i]["idcargoventa"] );
                var eliminar = document.createElement("i");
                eliminar.className = "red-text text-darken-2 tiny mdi-action-delete pointer";
                link1.appendChild(vista);
                celda.appendChild(link1);
                link3.appendChild(eliminar);
                celda.appendChild(link3);
                hilera.appendChild(celda);

                <!-- View Modal Structure -->
                var divcargosVenta = document.getElementById('cargosVenta')
                var divViewModalCargoventa = document.createElement('div')
                divViewModalCargoventa.className = "modal bottom-sheet";
                divViewModalCargoventa.setAttribute ( 'id', 'view-modal-cargoventa-'+cargoventaArray[i]["idcargoventa"]);
                var h4 = document.createElement('h4')
                var texth4 = document.createTextNode("Cargo-venta");
                h4.appendChild(texth4);
                var br = document.createElement('br')
                var divRow = document.createElement('div')
                divRow.className = "row";
                var fieldset = document.createElement('fieldset')
                var legend = document.createElement('legend')
                var textlegend = document.createTextNode("Datos generales");
                legend.appendChild(textlegend);
                var divCol1 = document.createElement('div')
                divCol1.className = "col s4";
                var divLabelContainer1 = document.createElement('div')
                divLabelContainer1.className = "label-container";
                var label1 = document.createElement('label')
                var textlabel1 = document.createTextNode("Cantidad:");
                label1.appendChild(textlabel1);
                var p1 = document.createElement('p')
                var textp1 = document.createTextNode(cargoventaArray[i]["cantidad"]);
                p1.appendChild(textp1);
                divLabelContainer1.appendChild(label1);
                divLabelContainer1.appendChild(p1);
                divCol1.appendChild(divLabelContainer1);
                var divCol2 = document.createElement('div')
                divCol2.className = "col s4";
                var divLabelContainer2 = document.createElement('div')
                divLabelContainer2.className = "label-container";
                var label2 = document.createElement('label')
                var textlabel2 = document.createTextNode("Artículo:");
                label2.appendChild(textlabel2);
                var p2 = document.createElement('p')
                var textp2 = document.createTextNode(cargoventaArray[i]["articulo"]);
                p2.appendChild(textp2);
                divLabelContainer2.appendChild(label2);
                divLabelContainer2.appendChild(p2);
                divCol2.appendChild(divLabelContainer2);
                var divCol3 = document.createElement('div')
                divCol3.className = "col s4";
                var divLabelContainer3 = document.createElement('div')
                divLabelContainer3.className = "label-container";
                var label3 = document.createElement('label')
                var textlabel3 = document.createTextNode("Descripción:");
                label3.appendChild(textlabel3);
                var p3 = document.createElement('p')
                var textp3 = document.createTextNode(cargoventaArray[i]["descripcion"]);
                p3.appendChild(textp3);
                divLabelContainer3.appendChild(label3);
                divLabelContainer3.appendChild(p3);
                divCol3.appendChild(divLabelContainer3);
                var divCol4 = document.createElement('div')
                divCol4.className = "col s4";
                var divLabelContainer4 = document.createElement('div')
                divLabelContainer4.className = "label-container";
                var label4 = document.createElement('label')
                var textlabel4 = document.createTextNode("Salida:");
                label4.appendChild(textlabel4);
                var p4 = document.createElement('p')
                var textp4 = document.createTextNode(cargoventaArray[i]["salida"]);
                p4.appendChild(textp4);
                divLabelContainer4.appendChild(label4);
                divLabelContainer4.appendChild(p4);
                divCol4.appendChild(divLabelContainer4);
                var divCol5 = document.createElement('div')
                divCol5.className = "col s4";
                var divLabelContainer5 = document.createElement('div')
                divLabelContainer5.className = "label-container";
                var label5 = document.createElement('label')
                var textlabel5 = document.createTextNode("Fecha/Hora:");
                label5.appendChild(textlabel5);
                var p5 = document.createElement('p')
                var textp5 = document.createTextNode(cargoventaArray[i]["fechahora"]);
                p5.appendChild(textp5);
                divLabelContainer5.appendChild(label5);
                divLabelContainer5.appendChild(p5);
                divCol5.appendChild(divLabelContainer5);
                var divCol6 = document.createElement('div')
                divCol6.className = "col s4";
                var divLabelContainer6 = document.createElement('div')
                divLabelContainer6.className = "label-container";
                var label6 = document.createElement('label')
                var textlabel6 = document.createTextNode("Precio:");
                label6.appendChild(textlabel6);
                var p6 = document.createElement('p')
                var textp6 = document.createTextNode(cargoventaArray[i]["precio"]);
                p6.appendChild(textp6);
                divLabelContainer6.appendChild(label6);
                divLabelContainer6.appendChild(p6);
                divCol6.appendChild(divLabelContainer6);
                var divCol7 = document.createElement('div')
                divCol7.className = "col s12";
                var divLabelContainer7 = document.createElement('div')
                divLabelContainer7.className = "label-container";
                var label7 = document.createElement('label')
                var textlabel7 = document.createTextNode("Subtotal:");
                label7.appendChild(textlabel7);
                var p7 = document.createElement('p')
                var textp7 = document.createTextNode(cargoventaArray[i]["subtotal"]);
                p7.appendChild(textp7);
                divLabelContainer7.appendChild(label7);
                divLabelContainer7.appendChild(p7);
                divCol7.appendChild(divLabelContainer7);
                fieldset.appendChild(divCol1);
                fieldset.appendChild(divCol2);
                fieldset.appendChild(divCol3);
                fieldset.appendChild(divCol4);
                fieldset.appendChild(divCol5);
                fieldset.appendChild(divCol6);
                fieldset.appendChild(divCol7);
                fieldset.appendChild(legend);
                divRow.appendChild(fieldset);
                var divViewModalFooter = document.createElement('div')
                divViewModalFooter.className = "modal-footer";
                var linkCerrar = document.createElement('a')
                linkCerrar.className = "modal-action modal-close waves-effect waves-light btn cerrar";
                var iconCerrar = document.createElement('i')
                iconCerrar.className = "mdi-navigation-close left";
                var textoIconCerrar = document.createTextNode('Cerrar');
                iconCerrar.appendChild(textoIconCerrar);
                linkCerrar.appendChild(iconCerrar);
                divViewModalFooter.appendChild(linkCerrar);
                divViewModalCargoventa.appendChild(br);
                divViewModalCargoventa.appendChild(h4);
                divViewModalCargoventa.appendChild(divRow);
                divViewModalCargoventa.appendChild(divViewModalFooter);
                divcargosVenta.appendChild(divViewModalCargoventa);
                <!-- End View Modal Structure -->

                <!-- Start Delete Structure -->
                var divcargosVentaDelete = document.getElementById('cargosVenta')
                var divDeleteModalCargoventaDelete = document.createElement('div')
                divDeleteModalCargoventaDelete.className = "modal";
                divDeleteModalCargoventaDelete.setAttribute ( 'id', 'delete-modal-cargoventa-'+cargoventaArray[i]["idcargoventa"]);
                var divDeleteModalContentCargoventaDelete = document.createElement('div')
                divDeleteModalContentCargoventaDelete.setAttribute ( 'id', 'delete-modal-cargoventa');
                divDeleteModalContentCargoventaDelete.className = "modal-content";

                var divRowDelete = document.createElement('div')
                divRowDelete.setAttribute ( 'id', 'delete-modal-header-container');
                divRowDelete.className = "row";
                var divRowAtencionDelete = document.createElement('div')
                divRowAtencionDelete.className = "col s4 offset-s4";
                var h4Delete = document.createElement('h4')
                var iDelete = document.createElement('i')
                iDelete.className = "mdi-alert-warning";
                var textoiDelete = document.createTextNode("ATENCION");
                iDelete.appendChild(textoiDelete);
                h4Delete.appendChild(iDelete);
                divRowAtencionDelete.appendChild(h4Delete);
                divRowDelete.appendChild(divRowAtencionDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRowDelete)

                var divRow2Delete = document.createElement('div')
                divRow2Delete.className = "row";
                var fieldsetDelete = document.createElement('fieldset')
                var legendDelete = document.createElement('legend')
                var textlegendDelete = document.createTextNode("Datos generales");
                legendDelete.appendChild(textlegendDelete);
                var divCol1Delete = document.createElement('div')
                divCol1Delete.className = "col s4";
                var divLabelContainer1Delete = document.createElement('div')
                divLabelContainer1Delete.className = "label-container";
                var label1Delete = document.createElement('label')
                var textlabel1Delete = document.createTextNode("Cantidad:");
                label1Delete.appendChild(textlabel1Delete);
                var p1Delete = document.createElement('p')
                var textp1Delete = document.createTextNode(cargoventaArray[i]["cantidad"]);
                p1Delete.appendChild(textp1Delete);
                divLabelContainer1Delete.appendChild(label1Delete);
                divLabelContainer1Delete.appendChild(p1Delete);
                divCol1Delete.appendChild(divLabelContainer1Delete);
                var divCol2Delete = document.createElement('div')
                divCol2Delete.className = "col s4";
                var divLabelContainer2Delete = document.createElement('div')
                divLabelContainer2Delete.className = "label-container";
                var label2Delete = document.createElement('label')
                var textlabel2Delete = document.createTextNode("Artículo:");
                label2Delete.appendChild(textlabel2Delete);
                var p2Delete = document.createElement('p')
                var textp2Delete = document.createTextNode(cargoventaArray[i]["articulo"]);
                p2Delete.appendChild(textp2Delete);
                divLabelContainer2Delete.appendChild(label2Delete);
                divLabelContainer2Delete.appendChild(p2Delete);
                divCol2Delete.appendChild(divLabelContainer2Delete);
                var divCol3Delete = document.createElement('div')
                divCol3Delete.className = "col s4";
                var divLabelContainer3Delete = document.createElement('div')
                divLabelContainer3Delete.className = "label-container";
                var label3Delete = document.createElement('label')
                var textlabel3Delete = document.createTextNode("Descripción:");
                label3Delete.appendChild(textlabel3Delete);
                var p3Delete = document.createElement('p')
                var textp3Delete = document.createTextNode(cargoventaArray[i]["descripcion"]);
                p3Delete.appendChild(textp3Delete);
                divLabelContainer3Delete.appendChild(label3Delete);
                divLabelContainer3Delete.appendChild(p3Delete);
                divCol3Delete.appendChild(divLabelContainer3Delete);
                var divCol4Delete = document.createElement('div')
                divCol4Delete.className = "col s4";
                var divLabelContainer4Delete = document.createElement('div')
                divLabelContainer4Delete.className = "label-container";
                var label4Delete = document.createElement('label')
                var textlabel4Delete = document.createTextNode("Salida:");
                label4Delete.appendChild(textlabel4Delete);
                var p4Delete = document.createElement('p')
                var textp4Delete = document.createTextNode(cargoventaArray[i]["salida"]);
                p4Delete.appendChild(textp4Delete);
                divLabelContainer4Delete.appendChild(label4Delete);
                divLabelContainer4Delete.appendChild(p4Delete);
                divCol4Delete.appendChild(divLabelContainer4Delete);
                var divCol5Delete = document.createElement('div')
                divCol5Delete.className = "col s4";
                var divLabelContainer5Delete = document.createElement('div')
                divLabelContainer5Delete.className = "label-container";
                var label5Delete = document.createElement('label')
                var textlabel5Delete = document.createTextNode("Fecha/Hora:");
                label5Delete.appendChild(textlabel5Delete);
                var p5Delete = document.createElement('p')
                var textp5Delete = document.createTextNode(cargoventaArray[i]["fechahora"]);
                p5Delete.appendChild(textp5Delete);
                divLabelContainer5Delete.appendChild(label5Delete);
                divLabelContainer5Delete.appendChild(p5Delete);
                divCol5Delete.appendChild(divLabelContainer5Delete);
                var divCol6Delete = document.createElement('div')
                divCol6Delete.className = "col s4";
                var divLabelContainer6Delete = document.createElement('div')
                divLabelContainer6Delete.className = "label-container";
                var label6Delete = document.createElement('label')
                var textlabel6Delete = document.createTextNode("Precio:");
                label6Delete.appendChild(textlabel6Delete);
                var p6Delete = document.createElement('p')
                var textp6Delete = document.createTextNode(cargoventaArray[i]["precio"]);
                p6Delete.appendChild(textp6Delete);
                divLabelContainer6Delete.appendChild(label6Delete);
                divLabelContainer6Delete.appendChild(p6Delete);
                divCol6Delete.appendChild(divLabelContainer6Delete);
                var divCol7Delete = document.createElement('div')
                divCol7Delete.className = "col s12";
                var divLabelContainer7Delete = document.createElement('div')
                divLabelContainer7Delete.className = "label-container";
                var label7Delete = document.createElement('label')
                var textlabel7Delete = document.createTextNode("Subtotal:");
                label7Delete.appendChild(textlabel7Delete);
                var p7Delete = document.createElement('p')
                var textp7Delete = document.createTextNode(cargoventaArray[i]["subtotal"]);
                p7Delete.appendChild(textp7Delete);
                divLabelContainer7Delete.appendChild(label7Delete);
                divLabelContainer7Delete.appendChild(p7Delete);
                divCol7Delete.appendChild(divLabelContainer7Delete);
                fieldsetDelete.appendChild(divCol1Delete);
                fieldsetDelete.appendChild(divCol2Delete);
                fieldsetDelete.appendChild(divCol3Delete);
                fieldsetDelete.appendChild(divCol4Delete);
                fieldsetDelete.appendChild(divCol5Delete);
                fieldsetDelete.appendChild(divCol6Delete);
                fieldsetDelete.appendChild(divCol7Delete);
                fieldsetDelete.appendChild(legendDelete);
                divRow2Delete.appendChild(fieldsetDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRow2Delete)

                var divRow3Delete = document.createElement('div')
                divRow3Delete.className = "row";
                var divRowPreguntaDelete = document.createElement('div')
                divRowPreguntaDelete.className = "col s12";
                var h5Delete = document.createElement('h5')
                var textoi2Delete = document.createTextNode("¿Estás seguro que deseas eliminar el cargo?");
                h5Delete.appendChild(textoi2Delete);
                divRowPreguntaDelete.appendChild(h5Delete);
                divRow3Delete.appendChild(divRowPreguntaDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRow3Delete)

                divDeleteModalCargoventaDelete.appendChild(divDeleteModalContentCargoventaDelete);

                var divDeleteModalFooterDelete = document.createElement('div')
                divDeleteModalFooterDelete.className = "modal-footer";
                var linkCerrarDelete = document.createElement('a')
                linkCerrarDelete.className = "modal-action modal-close waves-effect waves-light btn cerrar";
                var iconCerrarDelete = document.createElement('i')
                iconCerrarDelete.className = "mdi-navigation-close left";
                var textoIconCerrarDelete = document.createTextNode('Cerrar');
                iconCerrarDelete.appendChild(textoIconCerrarDelete);
                linkCerrarDelete.appendChild(iconCerrarDelete);
                var linkEliminarDelete = document.createElement('a')
                linkEliminarDelete.setAttribute ( 'id', 'eliminarCargoventa'+cargoventaArray[i]["idcargoventa"]);
                linkEliminarDelete.className = "waves-effect waves-light btn eliminar";
                var iconEliminarDelete = document.createElement('i')
                iconEliminarDelete.className = "mdi-action-delete left";
                var textoIconEliminarDelete = document.createTextNode('Eliminar');
                iconEliminarDelete.appendChild(textoIconEliminarDelete);
                linkEliminarDelete.appendChild(iconEliminarDelete);

                divDeleteModalFooterDelete.appendChild(linkCerrarDelete);
                divDeleteModalFooterDelete.appendChild(linkEliminarDelete);
                divDeleteModalCargoventaDelete.appendChild(divDeleteModalFooterDelete);
                divcargosVentaDelete.appendChild(divDeleteModalCargoventaDelete);
                <!-- End Delete Modal Structure -->

            }
        }
        // agrega la hilera al final de la tabla (al final del elemento tblbody)
        tblBody.appendChild(hilera);

    }

    // posiciona el <tbody> debajo del elemento <table>
    tabla.appendChild(tblBody);

    // appends <table> into <body>
    div.appendChild(tabla);
}

function tablaCargoventaServicioAgregado(cargoventaArray) {

    // Obtener la referencia del elemento div con id = cargoventaServicioResult
    var div = document.getElementById("cargoventaServicioResult");
    div.innerHTML = div.dir;
    // Crea un elemento <table> y un elemento <tbody>
    var tabla   = document.createElement("table");
    tabla.className = "hoverable striped";
    var tblHead = document.createElement("thead");
    var tblBody = document.createElement("tbody");

    var thArray = ['Cantidad', 'Servicio', 'Descripción', 'Fecha/hora', 'Precio', 'Subtotal', 'Opciones']

    // Crea las celdas
    for (var i = 0; i < 1; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("th");
            var textoCelda = document.createTextNode(thArray[j]);
            celda.appendChild(textoCelda);
            hilera.appendChild(celda);
        }

        // agrega la hilera al final de la tabla (al final del elemento tblHead)
        tblHead.appendChild(hilera);
    }

    // posiciona el <thead> debajo del elemento <tbody>
    tabla.appendChild(tblHead);

    // Crea las celdas
    for (var i = 0; i < cargoventaArray.length; i++) {

        var subTotalServicio = parseFloat(cargoventaArray[i]["subtotal"]);
        var status = cargoventaArray[i]["status"];

        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("td");

            if(j == 0){
                var textoCelda = document.createTextNode(cargoventaArray[i]["cantidad"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 1){
                var textoCelda = document.createTextNode(cargoventaArray[i]["servicio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 2){
                var textoCelda = document.createTextNode(cargoventaArray[i]["descripcion"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 3){
                var textoCelda = document.createTextNode(cargoventaArray[i]["fechahora"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 4){
                var textoCelda = document.createTextNode(cargoventaArray[i]["precio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 5){
                var textoCelda = document.createTextNode(cargoventaArray[i]["subtotal"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 6){

                <!-- Start View Modal Structure -->
                var divcargosVenta = document.getElementById('cargosVenta')
                var divViewModalCargoventa = document.createElement('div')
                divViewModalCargoventa.setAttribute ( 'id', 'view-modal-cargoventa-servicio-'+cargoventaArray[i]["idcargoventa"]);
                divViewModalCargoventa.className = "modal bottom-sheet";
                var h4 = document.createElement('h4')
                var texth4 = document.createTextNode("Cargo-venta");
                h4.appendChild(texth4);
                var br = document.createElement('br')
                var divRow = document.createElement('div')
                divRow.className = "row";
                var fieldset = document.createElement('fieldset')
                var legend = document.createElement('legend')
                var textlegend = document.createTextNode("Datos generales");
                legend.appendChild(textlegend);
                var divCol1 = document.createElement('div')
                divCol1.className = "col s4";
                var divLabelContainer1 = document.createElement('div')
                divLabelContainer1.className = "label-container";
                var label1 = document.createElement('label')
                var textlabel1 = document.createTextNode("Cantidad:");
                label1.appendChild(textlabel1);
                var p1 = document.createElement('p')
                var textp1 = document.createTextNode(cargoventaArray[i]["cantidad"]);
                p1.appendChild(textp1);
                divLabelContainer1.appendChild(label1);
                divLabelContainer1.appendChild(p1);
                divCol1.appendChild(divLabelContainer1);
                var divCol2 = document.createElement('div')
                divCol2.className = "col s4";
                var divLabelContainer2 = document.createElement('div')
                divLabelContainer2.className = "label-container";
                var label2 = document.createElement('label')
                var textlabel2 = document.createTextNode("Servicio:");
                label2.appendChild(textlabel2);
                var p2 = document.createElement('p')
                var textp2 = document.createTextNode(cargoventaArray[i]["servicio"]);
                p2.appendChild(textp2);
                divLabelContainer2.appendChild(label2);
                divLabelContainer2.appendChild(p2);
                divCol2.appendChild(divLabelContainer2);
                var divCol3 = document.createElement('div')
                divCol3.className = "col s4";
                var divLabelContainer3 = document.createElement('div')
                divLabelContainer3.className = "label-container";
                var label3 = document.createElement('label')
                var textlabel3 = document.createTextNode("Descripción:");
                label3.appendChild(textlabel3);
                var p3 = document.createElement('p')
                var textp3 = document.createTextNode(cargoventaArray[i]["descripcion"]);
                p3.appendChild(textp3);
                divLabelContainer3.appendChild(label3);
                divLabelContainer3.appendChild(p3);
                divCol3.appendChild(divLabelContainer3);
                var divCol4 = document.createElement('div')
                divCol4.className = "col s4";
                var divLabelContainer4 = document.createElement('div')
                divLabelContainer4.className = "label-container";
                var label4 = document.createElement('label')
                var textlabel4 = document.createTextNode("Fecha/Hora:");
                label4.appendChild(textlabel4);
                var p4 = document.createElement('p')
                var textp4 = document.createTextNode(cargoventaArray[i]["fechahora"]);
                p4.appendChild(textp4);
                divLabelContainer4.appendChild(label4);
                divLabelContainer4.appendChild(p4);
                divCol4.appendChild(divLabelContainer4);
                var divCol5 = document.createElement('div')
                divCol5.className = "col s4";
                var divLabelContainer5 = document.createElement('div')
                divLabelContainer5.className = "label-container";
                var label5 = document.createElement('label')
                var textlabel5 = document.createTextNode("Precio:");
                label5.appendChild(textlabel5);
                var p5 = document.createElement('p')
                var textp5 = document.createTextNode(cargoventaArray[i]["precio"]);
                p5.appendChild(textp5);
                divLabelContainer5.appendChild(label5);
                divLabelContainer5.appendChild(p5);
                divCol5.appendChild(divLabelContainer5);
                var divCol6 = document.createElement('div')
                divCol6.className = "col s4";
                var divLabelContainer6 = document.createElement('div')
                divLabelContainer6.className = "label-container";
                var label6 = document.createElement('label')
                var textlabel6 = document.createTextNode("Subtotal:");
                label6.appendChild(textlabel6);
                var p6 = document.createElement('p')
                var textp6 = document.createTextNode(cargoventaArray[i]["subtotal"]);
                p6.appendChild(textp6);
                divLabelContainer6.appendChild(label6);
                divLabelContainer6.appendChild(p6);
                divCol6.appendChild(divLabelContainer6);
                fieldset.appendChild(divCol1);
                fieldset.appendChild(divCol2);
                fieldset.appendChild(divCol3);
                fieldset.appendChild(divCol4);
                fieldset.appendChild(divCol5);
                fieldset.appendChild(divCol6);
                fieldset.appendChild(legend);
                divRow.appendChild(fieldset);
                var divViewModalFooter = document.createElement('div')
                divViewModalFooter.className = "modal-footer";
                var linkCerrar = document.createElement('a')
                linkCerrar.className = "modal-action modal-close waves-effect waves-light btn cerrar";
                var iconCerrar = document.createElement('i')
                iconCerrar.className = "mdi-navigation-close left";
                var textoIconCerrar = document.createTextNode('Cerrar');
                iconCerrar.appendChild(textoIconCerrar);
                linkCerrar.appendChild(iconCerrar);
                divViewModalFooter.appendChild(linkCerrar);
                divViewModalCargoventa.appendChild(br);
                divViewModalCargoventa.appendChild(h4);
                divViewModalCargoventa.appendChild(divRow);
                divViewModalCargoventa.appendChild(divViewModalFooter);
                divcargosVenta.appendChild(divViewModalCargoventa);
                <!-- End View Modal Structure -->

                <!-- Start Delete Modal Structure -->
                var divcargosVentaDelete = document.getElementById('cargosVenta')
                var divDeleteModalCargoventaDelete = document.createElement('div')
                divDeleteModalCargoventaDelete.setAttribute ( 'id', 'delete-modal-cargoventa-servicio-'+cargoventaArray[i]["idcargoventa"]);
                divDeleteModalCargoventaDelete.className = "modal";
                var divDeleteModalContentCargoventaDelete = document.createElement('div')
                divDeleteModalContentCargoventaDelete.setAttribute ( 'id', 'delete-modal-cargoventa-servicio');
                divDeleteModalContentCargoventaDelete.className = "modal-content";

                var divRowDelete = document.createElement('div')
                divRowDelete.setAttribute ( 'id', 'delete-modal-header-container');
                divRowDelete.className = "row";
                var divRowAtencionDelete = document.createElement('div')
                divRowAtencionDelete.className = "col s4 offset-s4";
                var h4Delete = document.createElement('h4')
                var iDelete = document.createElement('i')
                iDelete.className = "mdi-alert-warning";
                var textoiDelete = document.createTextNode("ATENCION");
                iDelete.appendChild(textoiDelete);
                h4Delete.appendChild(iDelete);
                divRowAtencionDelete.appendChild(h4Delete);
                divRowDelete.appendChild(divRowAtencionDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRowDelete)

                var divRow2Delete = document.createElement('div')
                divRow2Delete.className = "row";
                var fieldsetDelete = document.createElement('fieldset')
                var legendDelete = document.createElement('legend')
                var textlegendDelete = document.createTextNode("Datos generales");
                legendDelete.appendChild(textlegendDelete);
                var divCol1Delete = document.createElement('div')
                divCol1Delete.className = "col s4";
                var divLabelContainer1Delete = document.createElement('div')
                divLabelContainer1Delete.className = "label-container";
                var label1Delete = document.createElement('label')
                var textlabel1Delete = document.createTextNode("Cantidad:");
                label1Delete.appendChild(textlabel1Delete);
                var p1Delete = document.createElement('p')
                var textp1Delete = document.createTextNode(cargoventaArray[i]["cantidad"]);
                p1Delete.appendChild(textp1Delete);
                divLabelContainer1Delete.appendChild(label1Delete);
                divLabelContainer1Delete.appendChild(p1Delete);
                divCol1Delete.appendChild(divLabelContainer1Delete);
                var divCol2Delete = document.createElement('div')
                divCol2Delete.className = "col s4";
                var divLabelContainer2Delete = document.createElement('div')
                divLabelContainer2Delete.className = "label-container";
                var label2Delete = document.createElement('label')
                var textlabel2Delete = document.createTextNode("Servicio:");
                label2Delete.appendChild(textlabel2Delete);
                var p2Delete = document.createElement('p')
                var textp2Delete = document.createTextNode(cargoventaArray[i]["servicio"]);
                p2Delete.appendChild(textp2Delete);
                divLabelContainer2Delete.appendChild(label2Delete);
                divLabelContainer2Delete.appendChild(p2Delete);
                divCol2Delete.appendChild(divLabelContainer2Delete);
                var divCol3Delete = document.createElement('div')
                divCol3Delete.className = "col s4";
                var divLabelContainer3Delete = document.createElement('div')
                divLabelContainer3Delete.className = "label-container";
                var label3Delete = document.createElement('label')
                var textlabel3Delete = document.createTextNode("Descripción:");
                label3Delete.appendChild(textlabel3Delete);
                var p3Delete = document.createElement('p')
                var textp3Delete = document.createTextNode(cargoventaArray[i]["descripcion"]);
                p3Delete.appendChild(textp3Delete);
                divLabelContainer3Delete.appendChild(label3Delete);
                divLabelContainer3Delete.appendChild(p3Delete);
                divCol3Delete.appendChild(divLabelContainer3Delete);
                var divCol4Delete = document.createElement('div')
                divCol4Delete.className = "col s4";
                var divLabelContainer4Delete = document.createElement('div')
                divLabelContainer4Delete.className = "label-container";
                var label4Delete = document.createElement('label')
                var textlabel4Delete = document.createTextNode("Fecha/Hora:");
                label4Delete.appendChild(textlabel4Delete);
                var p4Delete = document.createElement('p')
                var textp4Delete = document.createTextNode(cargoventaArray[i]["fechahora"]);
                p4Delete.appendChild(textp4Delete);
                divLabelContainer4Delete.appendChild(label4Delete);
                divLabelContainer4Delete.appendChild(p4Delete);
                divCol4Delete.appendChild(divLabelContainer4Delete);
                var divCol5Delete = document.createElement('div')
                divCol5Delete.className = "col s4";
                var divLabelContainer5Delete = document.createElement('div')
                divLabelContainer5Delete.className = "label-container";
                var label5Delete = document.createElement('label')
                var textlabel5Delete = document.createTextNode("Precio:");
                label5Delete.appendChild(textlabel5Delete);
                var p5Delete = document.createElement('p')
                var textp5Delete = document.createTextNode(cargoventaArray[i]["precio"]);
                p5Delete.appendChild(textp5Delete);
                divLabelContainer5Delete.appendChild(label5Delete);
                divLabelContainer5Delete.appendChild(p5Delete);
                divCol5Delete.appendChild(divLabelContainer5Delete);
                var divCol6Delete = document.createElement('div')
                divCol6Delete.className = "col s4";
                var divLabelContainer6Delete = document.createElement('div')
                divLabelContainer6Delete.className = "label-container";
                var label6Delete = document.createElement('label')
                var textlabel6Delete = document.createTextNode("Subtotal:");
                label6Delete.appendChild(textlabel6Delete);
                var p6Delete = document.createElement('p')
                var textp6Delete = document.createTextNode(cargoventaArray[i]["subtotal"]);
                p6Delete.appendChild(textp6Delete);
                divLabelContainer6Delete.appendChild(label6Delete);
                divLabelContainer6Delete.appendChild(p6Delete);
                divCol6Delete.appendChild(divLabelContainer6Delete);
                fieldsetDelete.appendChild(divCol1Delete);
                fieldsetDelete.appendChild(divCol2Delete);
                fieldsetDelete.appendChild(divCol3Delete);
                fieldsetDelete.appendChild(divCol4Delete);
                fieldsetDelete.appendChild(divCol5Delete);
                fieldsetDelete.appendChild(divCol6Delete);
                fieldsetDelete.appendChild(legendDelete);
                divRow2Delete.appendChild(fieldsetDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRow2Delete)

                var divRow3Delete = document.createElement('div')
                divRow3Delete.className = "row";
                var divRowPreguntaDelete = document.createElement('div')
                divRowPreguntaDelete.className = "col s12";
                var h5Delete = document.createElement('h5')
                var textoi2Delete = document.createTextNode("¿Estás seguro que deseas eliminar el cargo?");
                h5Delete.appendChild(textoi2Delete);
                divRowPreguntaDelete.appendChild(h5Delete);
                divRow3Delete.appendChild(divRowPreguntaDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRow3Delete)

                divDeleteModalCargoventaDelete.appendChild(divDeleteModalContentCargoventaDelete);

                var divDeleteModalFooterDelete = document.createElement('div')
                divDeleteModalFooterDelete.className = "modal-footer";
                var linkCerrarDelete = document.createElement('a')
                linkCerrarDelete.className = "modal-action modal-close waves-effect waves-light btn cerrar";
                var iconCerrarDelete = document.createElement('i')
                iconCerrarDelete.className = "mdi-navigation-close left";
                var textoIconCerrarDelete = document.createTextNode('Cerrar');
                iconCerrarDelete.appendChild(textoIconCerrarDelete);
                linkCerrarDelete.appendChild(iconCerrarDelete);
                var linkEliminarDelete = document.createElement('a')
                linkEliminarDelete.setAttribute ( 'id', 'eliminarCargoventaServicio'+cargoventaArray[i]["idcargoventa"]);
                linkEliminarDelete.className = "waves-effect waves-light btn eliminar";
                var iconEliminarDelete = document.createElement('i')
                iconEliminarDelete.className = "mdi-action-delete left";
                var textoIconEliminarDelete = document.createTextNode('Eliminar');
                iconEliminarDelete.appendChild(textoIconEliminarDelete);
                linkEliminarDelete.appendChild(iconEliminarDelete);

                divDeleteModalFooterDelete.appendChild(linkCerrarDelete);
                divDeleteModalFooterDelete.appendChild(linkEliminarDelete);
                divDeleteModalCargoventaDelete.appendChild(divDeleteModalFooterDelete);
                divcargosVentaDelete.appendChild(divDeleteModalCargoventaDelete);
                <!-- End Delete Modal Structure -->

                var link1 = document.createElement("a");
                link1.className = "modal-trigger";
                link1.setAttribute ( 'data-position', 'left' );
                link1.setAttribute ( 'data-tooltip', 'VisualizarVenta' );
                link1.setAttribute ( 'href', '#view-modal-cargoventa-servicio-'+cargoventaArray[i]["idcargoventa"] );
                var vista = document.createElement("i");
                vista.className = "green-text text-darken-2 tiny mdi-image-remove-red-eye pointer";

                var link3 = document.createElement("a");
                link3.className = "tooltipped modal-trigger";
                link3.setAttribute ( 'data-position', 'right' );
                link3.setAttribute ( 'data-tooltip', 'EliminarVenta' );
                link3.setAttribute ( 'href', '#delete-modal-cargoventa-servicio-'+cargoventaArray[i]["idcargoventa"] );
                var eliminar = document.createElement("i");
                eliminar.className = "red-text text-darken-2 tiny mdi-action-delete pointer";
                link1.appendChild(vista);
                celda.appendChild(link1);
                link3.appendChild(eliminar);
                celda.appendChild(link3);
                hilera.appendChild(celda);

            }
        }

        // agrega la hilera al final de la tabla (al final del elemento tblbody)
        tblBody.appendChild(hilera);

        var idcargoventa = cargoventaArray[i]["idcargoventa"]
        var idventa = cargoventaArray[i]["idventa"]

    }

    // posiciona el <tbody> debajo del elemento <table>
    tabla.appendChild(tblBody);

    // appends <table> into <body>
    div.appendChild(tabla);

    // Si dan clic en eliminarCargoventaServicio-id
    $("#eliminarCargoventaServicio"+idcargoventa).click({idcargoventa:idcargoventa, idventa:idventa},function() {

        //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
        var dataString = 'eliminar_cargoventa_tipo=servicio' + '&idcargoventa=' + idcargoventa + '&idventa=' + idventa;

        $.ajax({
            type: "POST",
            url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
            dataType : 'json',
            data: dataString,
            jsonpCallback: 'callback',
            success: function(data) {
                alert("Se eliminó exitosamente el cargo de un servicio")
                $('#delete-modal-cargoventa-servicio-'+idcargoventa).closeModal();
                cargoventaArray = []
                var cargoventaEntity = data.cargoventaArray
                if(cargoventaEntity){
                    $.each( cargoventaEntity, function( key, value ) {
                        cargoventaArray.push({
                            "idcargoventa" : value.idcargoventa,
                            "idventa" : value.idventa,
                            "status" : value.status,
                            "cantidad" : value.cantidad,
                            "servicio" : value.servicio,
                            "descripcion" : value.descripcion,
                            "precio" : value.precio,
                            "subtotal" : value.subtotal,
                            "fechahora" : value.fechahora
                        });
                    });
                }

                tablaCargoventaServicioEliminado(cargoventaArray)
                tablaCargoventaServicioAgregadoModal(cargoventaArray)
                cargoventaEliminadoArray = []
                var cargoventaEliminado = data.cargoventaEliminadoArray
                if(cargoventaEliminado){
                    $.each( cargoventaEliminado, function( key, value ) {
                        cargoventaEliminadoArray.push({
                            "idcargoventa" : value.idcargoventa,
                            "idventa" : value.idventa,
                            "status" : value.status,
                            "cantidad" : value.cantidad,
                            "servicio" : value.servicio,
                            "descripcion" : value.descripcion,
                            "precio" : value.precio,
                            "subtotal" : value.subtotal,
                            "fechahora" : value.fechahora
                        });
                    });
                }
                subTotalResponse(status, null, -(cargoventaEliminadoArray[0]['subtotal']), 'venta')
            },
            error: function(){
                alert("Error al intentar eliminar cargo de un servicio")
            }
        });
        return false;

    });

    subTotalResponse(status, null, subTotalServicio, 'venta')
}

function tablaCargoventaServicioEliminado(cargoventaArray) {

    // Obtener la referencia del elemento div con id = cargoventaServicioResult
    var div = document.getElementById("cargoventaServicioResult");
    div.innerHTML = div.dir;
    // Crea un elemento <table> y un elemento <tbody>
    var tabla   = document.createElement("table");
    tabla.className = "hoverable striped";
    var tblHead = document.createElement("thead");
    var tblBody = document.createElement("tbody");

    var thArray = ['Cantidad', 'Servicio', 'Descripción', 'Fecha/hora', 'Precio', 'Subtotal', 'Opciones']

    // Crea las celdas
    for (var i = 0; i < 1; i++) {
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("th");
            var textoCelda = document.createTextNode(thArray[j]);
            celda.appendChild(textoCelda);
            hilera.appendChild(celda);
        }

        // agrega la hilera al final de la tabla (al final del elemento tblHead)
        tblHead.appendChild(hilera);
    }

    // posiciona el <thead> debajo del elemento <tbody>
    tabla.appendChild(tblHead);

    // Crea las celdas
    for (var i = 0; i < cargoventaArray.length; i++) {

        var subTotalServicio = parseFloat(cargoventaArray[i]["subtotal"]);
        var status = cargoventaArray[i]["status"];

        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < thArray.length; j++) {
            // Crea un elemento <td> y un nodo de texto, haz que el nodo de
            // texto sea el contenido de <td>, ubica el elemento <td> al final
            // de la hilera de la tabla
            var celda = document.createElement("td");

            if(j == 0){
                var textoCelda = document.createTextNode(cargoventaArray[i]["cantidad"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 1){
                var textoCelda = document.createTextNode(cargoventaArray[i]["servicio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 2){
                var textoCelda = document.createTextNode(cargoventaArray[i]["descripcion"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 3){
                var textoCelda = document.createTextNode(cargoventaArray[i]["fechahora"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 4){
                var textoCelda = document.createTextNode(cargoventaArray[i]["precio"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 5){
                var textoCelda = document.createTextNode(cargoventaArray[i]["subtotal"]);
                celda.appendChild(textoCelda);
                hilera.appendChild(celda);
            }
            if(j == 6){

                <!-- View Modal Structure -->
                var divcargosVenta = document.getElementById('cargosVenta')
                var divViewModalCargoventa = document.createElement('div')
                divViewModalCargoventa.setAttribute ( 'id', 'view-modal-cargoventa-servicio-'+cargoventaArray[i]["idcargoventa"]);
                divViewModalCargoventa.className = "modal bottom-sheet";
                var h4 = document.createElement('h4')
                var texth4 = document.createTextNode("Cargo-venta");
                h4.appendChild(texth4);
                var br = document.createElement('br')
                var divRow = document.createElement('div')
                divRow.className = "row";
                var fieldset = document.createElement('fieldset')
                var legend = document.createElement('legend')
                var textlegend = document.createTextNode("Datos generales");
                legend.appendChild(textlegend);
                var divCol1 = document.createElement('div')
                divCol1.className = "col s4";
                var divLabelContainer1 = document.createElement('div')
                divLabelContainer1.className = "label-container";
                var label1 = document.createElement('label')
                var textlabel1 = document.createTextNode("Cantidad:");
                label1.appendChild(textlabel1);
                var p1 = document.createElement('p')
                var textp1 = document.createTextNode(cargoventaArray[i]["cantidad"]);
                p1.appendChild(textp1);
                divLabelContainer1.appendChild(label1);
                divLabelContainer1.appendChild(p1);
                divCol1.appendChild(divLabelContainer1);
                var divCol2 = document.createElement('div')
                divCol2.className = "col s4";
                var divLabelContainer2 = document.createElement('div')
                divLabelContainer2.className = "label-container";
                var label2 = document.createElement('label')
                var textlabel2 = document.createTextNode("Servicio:");
                label2.appendChild(textlabel2);
                var p2 = document.createElement('p')
                var textp2 = document.createTextNode(cargoventaArray[i]["servicio"]);
                p2.appendChild(textp2);
                divLabelContainer2.appendChild(label2);
                divLabelContainer2.appendChild(p2);
                divCol2.appendChild(divLabelContainer2);
                var divCol3 = document.createElement('div')
                divCol3.className = "col s4";
                var divLabelContainer3 = document.createElement('div')
                divLabelContainer3.className = "label-container";
                var label3 = document.createElement('label')
                var textlabel3 = document.createTextNode("Descripción:");
                label3.appendChild(textlabel3);
                var p3 = document.createElement('p')
                var textp3 = document.createTextNode(cargoventaArray[i]["descripcion"]);
                p3.appendChild(textp3);
                divLabelContainer3.appendChild(label3);
                divLabelContainer3.appendChild(p3);
                divCol3.appendChild(divLabelContainer3);
                var divCol4 = document.createElement('div')
                divCol4.className = "col s4";
                var divLabelContainer4 = document.createElement('div')
                divLabelContainer4.className = "label-container";
                var label4 = document.createElement('label')
                var textlabel4 = document.createTextNode("Fecha/Hora:");
                label4.appendChild(textlabel4);
                var p4 = document.createElement('p')
                var textp4 = document.createTextNode(cargoventaArray[i]["fechahora"]);
                p4.appendChild(textp4);
                divLabelContainer4.appendChild(label4);
                divLabelContainer4.appendChild(p4);
                divCol4.appendChild(divLabelContainer4);
                var divCol5 = document.createElement('div')
                divCol5.className = "col s4";
                var divLabelContainer5 = document.createElement('div')
                divLabelContainer5.className = "label-container";
                var label5 = document.createElement('label')
                var textlabel5 = document.createTextNode("Precio:");
                label5.appendChild(textlabel5);
                var p5 = document.createElement('p')
                var textp5 = document.createTextNode(cargoventaArray[i]["precio"]);
                p5.appendChild(textp5);
                divLabelContainer5.appendChild(label5);
                divLabelContainer5.appendChild(p5);
                divCol5.appendChild(divLabelContainer5);
                var divCol6 = document.createElement('div')
                divCol6.className = "col s4";
                var divLabelContainer6 = document.createElement('div')
                divLabelContainer6.className = "label-container";
                var label6 = document.createElement('label')
                var textlabel6 = document.createTextNode("Subtotal:");
                label6.appendChild(textlabel6);
                var p6 = document.createElement('p')
                var textp6 = document.createTextNode(cargoventaArray[i]["subtotal"]);
                p6.appendChild(textp6);
                divLabelContainer6.appendChild(label6);
                divLabelContainer6.appendChild(p6);
                divCol6.appendChild(divLabelContainer6);
                fieldset.appendChild(divCol1);
                fieldset.appendChild(divCol2);
                fieldset.appendChild(divCol3);
                fieldset.appendChild(divCol4);
                fieldset.appendChild(divCol5);
                fieldset.appendChild(divCol6);
                fieldset.appendChild(legend);
                divRow.appendChild(fieldset);
                var divViewModalFooter = document.createElement('div')
                divViewModalFooter.className = "modal-footer";
                var linkCerrar = document.createElement('a')
                linkCerrar.className = "modal-action modal-close waves-effect waves-light btn cerrar";
                var iconCerrar = document.createElement('i')
                iconCerrar.className = "mdi-navigation-close left";
                var textoIconCerrar = document.createTextNode('Cerrar');
                iconCerrar.appendChild(textoIconCerrar);
                linkCerrar.appendChild(iconCerrar);
                divViewModalFooter.appendChild(linkCerrar);
                divViewModalCargoventa.appendChild(br);
                divViewModalCargoventa.appendChild(h4);
                divViewModalCargoventa.appendChild(divRow);
                divViewModalCargoventa.appendChild(divViewModalFooter);
                divcargosVenta.appendChild(divViewModalCargoventa);
                <!-- End View Modal Structure -->

                <!-- Start Delete Structure -->
                var divcargosVentaDelete = document.getElementById('cargosVenta')
                var divDeleteModalCargoventaDelete = document.createElement('div')
                divDeleteModalCargoventaDelete.setAttribute ( 'id', 'delete-modal-cargoventa-servicio-'+cargoventaArray[i]["idcargoventa"]);
                divDeleteModalCargoventaDelete.className = "modal";
                var divDeleteModalContentCargoventaDelete = document.createElement('div')
                divDeleteModalContentCargoventaDelete.setAttribute ( 'id', 'delete-modal-cargoventa-servicio');
                divDeleteModalContentCargoventaDelete.className = "modal-content";

                var divRowDelete = document.createElement('div')
                divRowDelete.setAttribute ( 'id', 'delete-modal-header-container');
                divRowDelete.className = "row";
                var divRowAtencionDelete = document.createElement('div')
                divRowAtencionDelete.className = "col s4 offset-s4";
                var h4Delete = document.createElement('h4')
                var iDelete = document.createElement('i')
                iDelete.className = "mdi-alert-warning";
                var textoiDelete = document.createTextNode("ATENCION");
                iDelete.appendChild(textoiDelete);
                h4Delete.appendChild(iDelete);
                divRowAtencionDelete.appendChild(h4Delete);
                divRowDelete.appendChild(divRowAtencionDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRowDelete)

                var divRow2Delete = document.createElement('div')
                divRow2Delete.className = "row";
                var fieldsetDelete = document.createElement('fieldset')
                var legendDelete = document.createElement('legend')
                var textlegendDelete = document.createTextNode("Datos generales");
                legendDelete.appendChild(textlegendDelete);
                var divCol1Delete = document.createElement('div')
                divCol1Delete.className = "col s4";
                var divLabelContainer1Delete = document.createElement('div')
                divLabelContainer1Delete.className = "label-container";
                var label1Delete = document.createElement('label')
                var textlabel1Delete = document.createTextNode("Cantidad:");
                label1Delete.appendChild(textlabel1Delete);
                var p1Delete = document.createElement('p')
                var textp1Delete = document.createTextNode(cargoventaArray[i]["cantidad"]);
                p1Delete.appendChild(textp1Delete);
                divLabelContainer1Delete.appendChild(label1Delete);
                divLabelContainer1Delete.appendChild(p1Delete);
                divCol1Delete.appendChild(divLabelContainer1Delete);
                var divCol2Delete = document.createElement('div')
                divCol2Delete.className = "col s4";
                var divLabelContainer2Delete = document.createElement('div')
                divLabelContainer2Delete.className = "label-container";
                var label2Delete = document.createElement('label')
                var textlabel2Delete = document.createTextNode("Servicio:");
                label2Delete.appendChild(textlabel2Delete);
                var p2Delete = document.createElement('p')
                var textp2Delete = document.createTextNode(cargoventaArray[i]["servicio"]);
                p2Delete.appendChild(textp2Delete);
                divLabelContainer2Delete.appendChild(label2Delete);
                divLabelContainer2Delete.appendChild(p2Delete);
                divCol2Delete.appendChild(divLabelContainer2Delete);
                var divCol3Delete = document.createElement('div')
                divCol3Delete.className = "col s4";
                var divLabelContainer3Delete = document.createElement('div')
                divLabelContainer3Delete.className = "label-container";
                var label3Delete = document.createElement('label')
                var textlabel3Delete = document.createTextNode("Descripción:");
                label3Delete.appendChild(textlabel3Delete);
                var p3Delete = document.createElement('p')
                var textp3Delete = document.createTextNode(cargoventaArray[i]["descripcion"]);
                p3Delete.appendChild(textp3Delete);
                divLabelContainer3Delete.appendChild(label3Delete);
                divLabelContainer3Delete.appendChild(p3Delete);
                divCol3Delete.appendChild(divLabelContainer3Delete);
                var divCol4Delete = document.createElement('div')
                divCol4Delete.className = "col s4";
                var divLabelContainer4Delete = document.createElement('div')
                divLabelContainer4Delete.className = "label-container";
                var label4Delete = document.createElement('label')
                var textlabel4Delete = document.createTextNode("Fecha/Hora:");
                label4Delete.appendChild(textlabel4Delete);
                var p4Delete = document.createElement('p')
                var textp4Delete = document.createTextNode(cargoventaArray[i]["fechahora"]);
                p4Delete.appendChild(textp4Delete);
                divLabelContainer4Delete.appendChild(label4Delete);
                divLabelContainer4Delete.appendChild(p4Delete);
                divCol4Delete.appendChild(divLabelContainer4Delete);
                var divCol5Delete = document.createElement('div')
                divCol5Delete.className = "col s4";
                var divLabelContainer5Delete = document.createElement('div')
                divLabelContainer5Delete.className = "label-container";
                var label5Delete = document.createElement('label')
                var textlabel5Delete = document.createTextNode("Precio:");
                label5Delete.appendChild(textlabel5Delete);
                var p5Delete = document.createElement('p')
                var textp5Delete = document.createTextNode(cargoventaArray[i]["precio"]);
                p5Delete.appendChild(textp5Delete);
                divLabelContainer5Delete.appendChild(label5Delete);
                divLabelContainer5Delete.appendChild(p5Delete);
                divCol5Delete.appendChild(divLabelContainer5Delete);
                var divCol6Delete = document.createElement('div')
                divCol6Delete.className = "col s4";
                var divLabelContainer6Delete = document.createElement('div')
                divLabelContainer6Delete.className = "label-container";
                var label6Delete = document.createElement('label')
                var textlabel6Delete = document.createTextNode("Subtotal:");
                label6Delete.appendChild(textlabel6Delete);
                var p6Delete = document.createElement('p')
                var textp6Delete = document.createTextNode(cargoventaArray[i]["subtotal"]);
                p6Delete.appendChild(textp6Delete);
                divLabelContainer6Delete.appendChild(label6Delete);
                divLabelContainer6Delete.appendChild(p6Delete);
                divCol6Delete.appendChild(divLabelContainer6Delete);
                fieldsetDelete.appendChild(divCol1Delete);
                fieldsetDelete.appendChild(divCol2Delete);
                fieldsetDelete.appendChild(divCol3Delete);
                fieldsetDelete.appendChild(divCol4Delete);
                fieldsetDelete.appendChild(divCol5Delete);
                fieldsetDelete.appendChild(divCol6Delete);
                fieldsetDelete.appendChild(legendDelete);
                divRow2Delete.appendChild(fieldsetDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRow2Delete)

                var divRow3Delete = document.createElement('div')
                divRow3Delete.className = "row";
                var divRowPreguntaDelete = document.createElement('div')
                divRowPreguntaDelete.className = "col s12";
                var h5Delete = document.createElement('h5')
                var textoi2Delete = document.createTextNode("¿Estás seguro que deseas eliminar el cargo?");
                h5Delete.appendChild(textoi2Delete);
                divRowPreguntaDelete.appendChild(h5Delete);
                divRow3Delete.appendChild(divRowPreguntaDelete);
                divDeleteModalContentCargoventaDelete.appendChild(divRow3Delete)

                divDeleteModalCargoventaDelete.appendChild(divDeleteModalContentCargoventaDelete);

                var divDeleteModalFooterDelete = document.createElement('div')
                divDeleteModalFooterDelete.className = "modal-footer";
                var linkCerrarDelete = document.createElement('a')
                linkCerrarDelete.className = "modal-action modal-close waves-effect waves-light btn cerrar";
                var iconCerrarDelete = document.createElement('i')
                iconCerrarDelete.className = "mdi-navigation-close left";
                var textoIconCerrarDelete = document.createTextNode('Cerrar');
                iconCerrarDelete.appendChild(textoIconCerrarDelete);
                linkCerrarDelete.appendChild(iconCerrarDelete);
                var linkEliminarDelete = document.createElement('a')
                linkEliminarDelete.setAttribute ( 'id', 'eliminarCargoventaServicio'+cargoventaArray[i]["idcargoventa"]);
                linkEliminarDelete.className = "waves-effect waves-light btn eliminar";
                var iconEliminarDelete = document.createElement('i')
                iconEliminarDelete.className = "mdi-action-delete left";
                var textoIconEliminarDelete = document.createTextNode('Eliminar');
                iconEliminarDelete.appendChild(textoIconEliminarDelete);
                linkEliminarDelete.appendChild(iconEliminarDelete);

                divDeleteModalFooterDelete.appendChild(linkCerrarDelete);
                divDeleteModalFooterDelete.appendChild(linkEliminarDelete);
                divDeleteModalCargoventaDelete.appendChild(divDeleteModalFooterDelete);
                divcargosVentaDelete.appendChild(divDeleteModalCargoventaDelete);
                <!-- End Delete Modal Structure -->

                var link1 = document.createElement("a");
                link1.className = "modal-trigger";
                link1.setAttribute ( 'data-position', 'left' );
                link1.setAttribute ( 'data-tooltip', 'VisualizarVenta' );
                link1.setAttribute ( 'href', '#view-modal-cargoventa-servicio-'+cargoventaArray[i]["idcargoventa"] );
                var vista = document.createElement("i");
                vista.className = "green-text text-darken-2 tiny mdi-image-remove-red-eye pointer";

                var link3 = document.createElement("a");
                link3.className = "tooltipped modal-trigger";
                link3.setAttribute ( 'data-position', 'right' );
                link3.setAttribute ( 'data-tooltip', 'EliminarVenta' );
                link3.setAttribute ( 'href', '#delete-modal-cargoventa-servicio-'+cargoventaArray[i]["idcargoventa"] );
                var eliminar = document.createElement("i");
                eliminar.className = "red-text text-darken-2 tiny mdi-action-delete pointer";
                link1.appendChild(vista);
                celda.appendChild(link1);
                link3.appendChild(eliminar);
                celda.appendChild(link3);
                hilera.appendChild(celda);
            }
        }

        // agrega la hilera al final de la tabla (al final del elemento tblbody)
        tblBody.appendChild(hilera);

    }

    // posiciona el <tbody> debajo del elemento <table>
    tabla.appendChild(tblBody);

    // appends <table> into <body>
    div.appendChild(tabla);
}

var subTotal = 0;
var anticipoCantidad = 0;
var cuentaPagada = false;
function subTotalResponse(status, subTotalArticulo=null, subTotalServicio=null, tipo=null, AnticipoCantidad=null, Tipodepago="no identificado", referenciapago) {

    // restar el anticipo del total de la cuenta y que var anticipoCantidad sea igual a anticipoCantidad

    subTotal += subTotalArticulo+subTotalServicio;
    if (isNaN(subTotal)) subTotal = 0;

    anticipoCantidad += Number(AnticipoCantidad);

    if (isNaN(referenciapago)) referenciapago = "";

    if(subTotal == 0){

        status = 'pagada';

        if(tipo == "venta"){

            var venta_tipodepago = Tipodepago;

            var idventa = $("input#idventa").val();

            //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
            var dataString = 'subTotalVenta=' + subTotal + '&idventa=' + idventa + '&venta_status=' + status + '&venta_total=' + anticipoCantidad + "&venta_tipodepago=" + venta_tipodepago + '&venta_referenciapago=' + referenciapago;

            $.ajax({
                type: "POST",
                url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
                dataType : 'json',
                data: dataString,
                jsonpCallback: 'callback',
                success: function(data) {

                    alert("Cuenta liquidada.")

                    // Cerramos modal
                    $("#create-modal-pagar-venta").closeModal()
                    // Deshabilitar el boton de Pago/Anticipo y habilitar los botones de Alta Paciente, Generar Factura y Generar Nota
                    $("#nuevoCargoVentaArticulo").removeClass('modal-trigger').addClass('disabled').removeAttr('href').off( "click");
                    $("#nuevoCargoVentaServicio").removeClass('modal-trigger').addClass('disabled').removeAttr('href').off( "click");
                    $("#butonPagarAnticipoVenta").removeClass('modal-trigger').addClass('disabled').removeAttr('href').off( "click");
                    $("#botonAltaPacienteVenta").removeClass('disabled')
                    $('#buttonGenerarFacturaVenta').removeClass('disabled')
                    $("#buttonGenerarNotaVenta").removeClass('disabled')
                    //$( "a" ).off();
                    $( "div#cargoventaArticuloResult a" ).off()

                },
                error: function(){
                    alert("Error al intentar liquidar la cuenta.")
                }
            });
        }
    }

    if(tipo == "venta"){

        // Creamos los elementos de Pago Venta
        var pagoVenta = document.getElementById("pagoVenta");
        pagoVenta.innerHTML = pagoVenta.dir;

        var divCantidadRestantePago = document.createElement('div')
        divCantidadRestantePago.className = "col s12";
        var spanPago = document.createElement('span')
        var cantidadRestantePago = document.createTextNode("Cantidad restante: "+subTotal);
        spanPago.appendChild(cantidadRestantePago);
        divCantidadRestantePago.appendChild(spanPago);
        pagoVenta.appendChild(divCantidadRestantePago);
        var br1 = document.createElement('br')
        pagoVenta.appendChild(br1);

        var divMetodoDePago = document.createElement('div')
        divMetodoDePago.className = "col s12";
        divMetodoDePago.setAttribute ( 'id', 'divMetodoDePago' );
        var spanMetodoDePago = document.createElement('span')
        var metodoDePago = document.createTextNode("Método de pago: ");
        spanMetodoDePago.appendChild(metodoDePago);
        divMetodoDePago.appendChild(spanMetodoDePago);

        var select = document.createElement('select');
        select.style.display = "inline";
        select.style.width = "auto";
        select.style.height = "auto";
        select.setAttribute ( 'id', 'select_metodo_de_pago' );
        var metodosArray = ["Efectivo", "Tarjeta de credito", "Tarjeta de debito", "Cheque", "SPEI", "No identificado"];
        // agregamos los valores <option> a seleccionar
        for($i=0; $i<=metodosArray.length; $i++){
            var selectOption = new Option(metodosArray[$i],metodosArray[$i]);
            select.appendChild(selectOption);
        }
        divMetodoDePago.appendChild(select);

        var span2 = document.createElement('span')
        var espacio = document.createTextNode("   ");
        span2.appendChild(espacio);
        divMetodoDePago.appendChild(span2);

        var inputMetodoDePago = document.createElement('input')
        inputMetodoDePago.style.width = "auto";
        inputMetodoDePago.setAttribute ( 'id', 'input_pago_venta' );
        inputMetodoDePago.setAttribute ( 'type', 'text' );
        inputMetodoDePago.setAttribute ( 'name', 'pago' );
        inputMetodoDePago.setAttribute ( 'value', subTotal );
        inputMetodoDePago.setAttribute ( 'readonly', 'readonly');
        divMetodoDePago.appendChild(inputMetodoDePago);
        pagoVenta.appendChild(divMetodoDePago);

        /*
        var divInputNotaPago = document.createElement('div')
        divInputNotaPago.className = "input-field col s12";
        var inputNotaPago = document.createElement('input')
        inputNotaPago.setAttribute ( 'id', 'input_nota_pago' );
        inputNotaPago.setAttribute ( 'type', 'text' );
        inputNotaPago.setAttribute ( 'name', 'nota_pago' );
        divInputNotaPago.appendChild(inputNotaPago);
        var labelNotaPago = document.createElement('label')
        var notaPago = document.createTextNode("Nota")
        labelNotaPago.appendChild(notaPago);
        labelNotaPago.setAttribute ( 'for', 'input_nota_pago' );
        divInputNotaPago.appendChild(labelNotaPago);
        pagoVenta.appendChild(divInputNotaPago);
        */
        var divBotonPagar = document.createElement('div')
        divBotonPagar.className = "right col s4";
        divBotonPagar.setAttribute ( 'id', 'divBotonVentaPagarPago' );
        var botonPagar = document.createElement('button')
        botonPagar.className = "btn waves-effect waves-light";
        botonPagar.style.width = "auto";
        botonPagar.style.height = "45px";
        botonPagar.style.marginTop = "20px";
        var textBotonPagar = document.createTextNode("Pagar");
        botonPagar.appendChild(textBotonPagar);
        divBotonPagar.appendChild(botonPagar);
        pagoVenta.appendChild(divBotonPagar);
        // Creamos los elementos de Pago Venta

        var divTotalSuperior = document.getElementById("totalSuperior");
        divTotalSuperior.innerHTML = divTotalSuperior.dir;
        var divSubTotal = document.createElement('div');
        divSubTotal.className = "col s3";
        var divStatus = document.createElement('div');
        divStatus.className = "col s3";
        var textoSubTotal = document.createTextNode(" Total: $"+subTotal+" MXN");
        var textoStatus = document.createTextNode("Status: "+status);
        divSubTotal.appendChild(textoSubTotal);
        divStatus.appendChild(textoStatus);
        divTotalSuperior.appendChild(divSubTotal);
        divTotalSuperior.appendChild(divStatus);

        var divTotalInferior = document.getElementById("totalInferior");
        divTotalInferior.innerHTML = divTotalInferior.dir;
        var h4 = document.createElement('h4')
        h4.className = "right-align";
        var textoServicioTotal = document.createTextNode("Total: $"+subTotal+" MXN");
        h4.appendChild(textoServicioTotal)
        divTotalInferior.appendChild(h4)

        var divbotonPagarAnticipo = document.getElementById("botonPagarAnticipoVenta");
        divbotonPagarAnticipo.innerHTML = divbotonPagarAnticipo.dir;
        var buttonPagarAnticipo = document.createElement('button')
        buttonPagarAnticipo.setAttribute ( 'id', 'butonPagarAnticipoVenta' );
        buttonPagarAnticipo.setAttribute ( 'href', '#create-modal-pagar-venta' );
        buttonPagarAnticipo.className = "modal-trigger btn waves-effect waves-light";
        buttonPagarAnticipo.style.width = "100%";
        buttonPagarAnticipo.style.height = "45px";
        buttonPagarAnticipo.style.marginTop = "53px";
        var textoButtonPagarAnticipo = document.createTextNode("Pagar");
        buttonPagarAnticipo.appendChild(textoButtonPagarAnticipo)
        divbotonPagarAnticipo.appendChild(buttonPagarAnticipo)
        //botonPagarAnticipo
        $('.modal-trigger').leanModal();

        <?php /*
        var divbotonGenerarFactura = document.getElementById("botonGenerarFactura");
        divbotonGenerarFactura.innerHTML = divbotonGenerarFactura.dir;
        var buttonGenerarFactura = document.createElement('button')
        buttonGenerarFactura.setAttribute ( 'id', 'buttonGenerarFacturaVenta' );
        buttonGenerarFactura.style.width = "100%";
        buttonGenerarFactura.style.height = "45px";
        buttonGenerarFactura.style.marginTop = "20px";
        buttonGenerarFactura.className = "btn waves-effect waves-light disabled";
        buttonGenerarFactura.setAttribute ( 'type', 'submit' );
        var textoButtonGenerarFactura = document.createTextNode("Generar Factura");
        buttonGenerarFactura.appendChild(textoButtonGenerarFactura)
        divbotonGenerarFactura.appendChild(buttonGenerarFactura)
         * 
         */?>
                     
        <?php /*
        var divbotonGenerarNota = document.getElementById("botonGenerarNota");
        divbotonGenerarNota.innerHTML = divbotonGenerarNota.dir;
        var buttonGenerarNota = document.createElement('button')
        buttonGenerarNota.setAttribute ( 'id', 'buttonGenerarNotaVenta' );

        buttonGenerarNota.style.width = "100%";
        buttonGenerarNota.style.height = "45px";
        buttonGenerarNota.style.marginTop = "20px";
        buttonGenerarNota.className = "btn waves-effect waves-light disabled";
        buttonGenerarNota.setAttribute ( 'type', 'submit' );
        var textoButtonGenerarNota = document.createTextNode("Generar Nota");
        buttonGenerarNota.appendChild(textoButtonGenerarNota)
        divbotonGenerarNota.appendChild(buttonGenerarNota)
         * 
         */?>

        <?php /*
        var divbotoVerFactura = document.getElementById("botonVerFactura");
        divbotoVerFactura.innerHTML = divbotoVerFactura.dir;
        var buttonVerFactura = document.createElement('button')
        buttonVerFactura.setAttribute ( 'id', 'buttonVerFacturaVenta' );
        buttonVerFactura.style.width = "100%";
        buttonVerFactura.style.height = "45px";
        buttonVerFactura.className = "left btn waves-effect waves-light disabled";
        buttonVerFactura.setAttribute ( 'type', 'submit' );
        var textoButtonVerFactura = document.createTextNode("Ver Factura");
        buttonVerFactura.appendChild(textoButtonVerFactura)
        divbotoVerFactura.appendChild(buttonVerFactura)
         * 
         */?>

        var divbotonCancelar = document.getElementById("botonCancelar");
        divbotonCancelar.innerHTML = divbotonCancelar.dir;
        var buttonCancelar = document.createElement('button')
        buttonCancelar.setAttribute ( 'id', 'buttonCancelarVenta' );
        buttonCancelar.style.width = "100%";
        buttonCancelar.style.height = "45px";
        buttonCancelar.className = "btn waves-effect waves-light";
        buttonCancelar.setAttribute ( 'type', 'submit' );
        var textoButtonCancelar = document.createTextNode("Cancelar");
        buttonCancelar.appendChild(textoButtonCancelar)
        divbotonCancelar.appendChild(buttonCancelar)

    }

    $("#divBotonVentaPagarPago").click(function() {

        // Si el método de pago es con tarjeta, le solicitamos al usuario la referencia de la tarjeta)
        if($("#select_metodo_de_pago").val() == 'Tarjeta de credito' || $("#select_metodo_de_pago").val() == 'Tarjeta de debito'){
            var venta_referenciapago = prompt("Por favor ingresa la referencia de la tarjeta", "1234");
        }
        var pagoVenta = $("input#input_pago_venta").val();
        if(pagoVenta > subTotal || pagoVenta < 0){
            //var pago = $("input#divMetodoDePago").val();
            alert("La cantidad agregada: "+pagoVenta+" no puede ser mayor a: "+subTotal+" ni menor o igual a 0.")
            return false;
        }

        var idventa = $("input#idventa").val();

        //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
        var dataString = 'idventa=' + idventa + '&cargoventa_cantidad=' + pagoVenta + '&cargoventa_tipo=' + $("#select_metodo_de_pago").val();

        $.ajax({
            type: "POST",
            url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
            dataType : 'json',
            data: dataString,
            jsonpCallback: 'callback',
            success: function(data) {

                /*
                cargoventaArray = []
                var cargoventaEntity = data.cargoventaArray
                $.each( cargoventaEntity, function( key, value ) {
                    cargoventaArray.push({

                    });
                });

                subTotalResponse(status, -(pagoVenta), null, 'venta', pagoVenta, $("#select_metodo_de_pago").val(), venta_referenciapago)
                */

                /**
                 * No entra aqui porque la respuesta trae tanto articulo como servicio y al querer llamar a los 2 causa conflicto... pero  los guarda :)
                 */
            },
            error: function(data){

                /** Con este paso Liquidamos la cuenta */
                subTotalResponse(status, -(pagoVenta), null, 'venta', pagoVenta, $("#select_metodo_de_pago").val(), venta_referenciapago)
            }
        });

        return false;
    });

    $("#buttonCancelarVenta").click(function() {

        var idventa = $("input#idventa").val();

        //Construimos la variable que se guardará en el data del Ajax para pasar a la url que procesará los datos
        var dataString = 'idventa=' + idventa + '&ecancelar=true';


        $.ajax({
            type: "POST",
            url: "<?php $this->url('venta', array('action'=>'asignar', 'id' => $pacienteEntity->getIdpaciente()));?>",
            dataType : 'json',
            data: dataString,
            jsonpCallback: 'callback',
            success: function(data) {

                alert("Venta Cancelada");

                // redireccionamos al listado
                window.location="<?php echo $this->url('venta')?>";

            },
            error: function(data){
                alert("Error al intentar cancelar la venta");
            }
        });

        return false;
    });
}

function pagoVenta() {
    if ($('#pagoVenta').hasClass('hiddendiv')){
        $('#pagoVenta').removeClass('hiddendiv')
    }
}

</script>